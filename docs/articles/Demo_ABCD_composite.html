<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Getting started 2: composite runs • isobxr</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Getting started 2: composite runs">
<meta property="og:description" content="isobxr">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">isobxr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Demo_ABCD.html">Getting started 1: single runs</a>
    </li>
    <li>
      <a href="../articles/Demo_ABCD_composite.html">Getting started 2: composite runs</a>
    </li>
    <li>
      <a href="../articles/isobxr_vignette.html">Using isobxr</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/ttacail/isobxr/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Getting started 2: composite runs</h1>
                        <h4 class="author">Théo Tacail</h4>
            
            <h4 class="date">2020-10-22</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/ttacail/isobxr/blob/master/vignettes/Demo_ABCD_composite.Rmd"><code>vignettes/Demo_ABCD_composite.Rmd</code></a></small>
      <div class="hidden name"><code>Demo_ABCD_composite.Rmd</code></div>

    </div>

    
    
<hr>
<p>This vignette is designed to be used as a <strong>getting started demo 2</strong> for the <a href="https://ttacail.github.io/isobxr/">isobxr</a> package.</p>
<p>Please refer to the <a href="https://ttacail.github.io/isobxr/articles/isobxr_vignette.html">general vignette</a> for a more exhaustive explanation of the package content and use.</p>
<hr>
<div id="prepare-the-demo" class="section level1">
<h1 class="hasAnchor">
<a href="#prepare-the-demo" class="anchor"></a>Prepare the demo</h1>
<ol style="list-style-type: decimal">
<li><p>If not done yet, install the <a href="https://ttacail.github.io/isobxr/">isobxr</a> package (<a href="https://ttacail.github.io/isobxr/articles/isobxr_vignette.html#installation-1">installation instructions</a>).</p></li>
<li><p>Load isobxr in R:</p></li>
</ol>
<div class="sourceCode"><pre class="downlit">
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/ttacail/isobxr">isobxr</a></span><span class="op">)</span></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>
<a href="https://ttacail.github.io/source/demos/1_ABCD.zip">Download the ABCD demo zip file</a>.</li>
</ol>
<dl>
<dt>Note</dt>
<dd>Templates for all input and master excel files described in this vignette are available for <a href="https://ttacail.github.io/source/demos/0_excel_templates.zip">download here</a>.
</dd>
</dl>
<ol start="4" style="list-style-type: decimal">
<li><p>Unzip the ABCD demo file and place it in the working directory of your choice. It is strongly advised to avoid using a working directory linked to an online backup server (such as OneDrive) since it could cause some issues with adressing of output files. If done so, users are then advised to turn the backup server software offline during the use of isobxr functions.</p></li>
<li><p>Take note of the path to this folder, for instance:</p></li>
</ol>
<div class="sourceCode"><pre class="downlit">
<span class="va">workingdir</span> <span class="op">&lt;-</span> <span class="st">"/Users/username/Documents/isobxr/demos/1_ABCD/"</span></pre></div>
<p>or set it as a working directory, for instance:</p>
<div class="sourceCode"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/getwd.html">setwd</a></span><span class="op">(</span><span class="st">"/Users/username/Documents/isobxr/demos/1_ABCD"</span><span class="op">)</span></pre></div>
<p>Everything is now ready to run box models with <strong>isobxr</strong>.</p>
<hr>
</div>
<div id="systems-and-isobxr-master-file" class="section level1">
<h1 class="hasAnchor">
<a href="#systems-and-isobxr-master-file" class="anchor"></a>Systems and <em>isobxr master file</em>
</h1>
<p>If you just followed the <strong>Getting started 1: single runs</strong> demo, this part can be skipped as this demo uses the same <em>isobxr master file</em>.</p>
<p>We consider the demonstration <em>isobxr master file</em> (0_ISOBXR_MASTER.xlsx) stored in the working directory. In this demonstration example, the <em>isobxr master file</em> describes an imaginary model, designed for the calcium <span class="math inline">\(^{44}Ca/^{42}Ca\)</span> isotope ratios.</p>
<p><img src="10_ABCD_CONSTANTS.png" width="75%"></p>
<p>The <strong>BOXES</strong> sheet describes 4 finite boxes (A, B, C, D) and 2 infinite boxes (SOURCE and SINK).</p>
<p>The layout of the boxes in the diagram rendering aims at placing the finite boxes on the four corners of 10x10 units square, and the two infinite boxes on the higher end of the layout (y = 15), with SOURCE on the far left and SINK on the far right.</p>
<p><img src="40_ABCD_BOXES.png" width="50%"></p>
<p>We assume that fluxes are expressed in mg of Ca per day, sizes in mg of Ca and run time units will be days.</p>
<p>The <strong>FLUXES</strong> sheet describes 5 flux lists</p>
<ol style="list-style-type: decimal">
<li>
<em>Fx1_ABC_bal</em> describes a balanced closed system composed of 3 finite boxes A, B and C.<br>
</li>
<li>
<em>Fx2_ABC_unbal</em> describes an unbalanced closed system composed of 3 finite boxes A, B and C.<br>
</li>
<li>
<em>Fx3_ABC_unbal</em> describes an unbalanced closed system composed of 3 finite boxes A, B and C.<br>
</li>
<li>
<em>Fx4_ABCD_bal</em> describes a balanced closed system composed of 4 finite boxes A, B, C and D.<br>
</li>
<li>
<em>Fx5_ABCD_unbal</em> describes an unbalanced closed system composed of 4 finite boxes A, B, C and D.<br>
</li>
<li>
<em>Fx6_ABC_open_bal</em> describes a balanced open system composed of 4 finite boxes A, B, C and D and two infinite boxes SOURCE and SINK.</li>
<li>
<em>Fx7_ABC_open_unbal</em> describes an unbalanced open system composed of 4 finite boxes A, B, C and D and two infinite boxes SOURCE and SINK.</li>
</ol>
<p>Sizes of all finite boxes are here set at 2000 mg, infinite boxes are set a 1e15 mg.</p>
<p><img src="41_ABCD_FLUXES.png" width="100%"></p>
<p>The <strong>COEFFS</strong> sheet describes 5 lists of fractionation coefficients:</p>
<ul>
<li>
<em>a0</em> describes no isotope fractionation (all <span class="math inline">\(\alpha_{i \to j}\)</span> being equal to one)<br>
</li>
<li>
<em>a1</em> describes a system with 1 fractionation coefficient being different from 1:<br><span class="math inline">\(\alpha_{A \to B} = 0.999\)</span><br>
</li>
<li>
<em>a2</em> describes a system with 2 fractionation coefficients being different from 1:<br><span class="math inline">\(\alpha_{A \to B} = 0.999\)</span>, <span class="math inline">\(\alpha_{B \to A} = 1.001\)</span><br>
</li>
<li>
<em>a3</em> describes a system with 3 fractionation coefficients being different from 1:<br><span class="math inline">\(\alpha_{A \to B} = 0.999\)</span>, <span class="math inline">\(\alpha_{B \to A} = 1.001\)</span>, <span class="math inline">\(\alpha_{C \to A} = 0.9997\)</span><br>
</li>
<li>
<em>a4</em> describes a system with 1 fractionation coefficient being different from 1:<br><span class="math inline">\(\alpha_{C \to D} = 0.99\)</span>
</li>
</ul>
<p><img src="13_ABCD_COEFFS.png" width="100%"></p>
<hr>
<hr>
</div>
<div id="compose-isobxr-scenarios-with-compose_isobxr" class="section level1">
<h1 class="hasAnchor">
<a href="#compose-isobxr-scenarios-with-compose_isobxr" class="anchor"></a>Compose isobxr scenarios with <code>compose_isobxr</code>
</h1>
<div id="example-1-perturbating-the-fluxes" class="section level2">
<h2 class="hasAnchor">
<a href="#example-1-perturbating-the-fluxes" class="anchor"></a>example #1: perturbating the fluxes</h2>
<p>We compose here the first scenario as described on the screenshot of the <em>composite master file</em> used for this run (0_COMPO_MASTER_balance_change.xlsx) and found in the directory.</p>
<p><img src="30_RUN_LIST_ABC.png" width="75%"></p>
<p>Here, we start with a previous example from <strong>Getting started 1: Single runs</strong> demo: a set of 3 finite boxes (A, B, C) consituting an open system interacting with the environment (SOURCE and SINK boxes).</p>
<p>As defined in the <strong>RUN_LIST</strong> sheet of the <em>composite master file</em>, 1. We first let the system relax to its' steady-state in a balanced configuration using the <em>Fx6_ABC_open_bal</em> flux list for a total of 25000 days (70 years).<br>
1. We then let the system run with the exact same conditions for 100 days.<br>
1. We then provoke a disequilibrium by using an unbalanced <em>Fx7_ABC_open_unbal</em> flux list (A loses 10 mg of Ca per day, B accumulates 10 mg of Ca per day).<br>
1. We then let the system relax again with the previous balanced flux configuration (<em>Fx6_ABC_open_bal</em>) but with automatically inherited different initial conditions of delta and size values.</p>
<p>All other sheets defining forcing parameters (<strong>FORCING_RAYLEIGH</strong>, <strong>FORCING_SIZE</strong>, <strong>FORCING_DELTA</strong>, <strong>FORCING_ALPHA</strong>) are left empty (with column headers as defined by template but empty lines).</p>
<p>We call the function as follows:</p>
<div class="sourceCode"><pre class="downlit">
<span class="va">workdir</span> <span class="op">&lt;-</span> <span class="st">"~/DEMO_ABCD"</span> <span class="co"># isobxr and compo master file work. dir.</span>
<span class="va">SERIES_ID</span> <span class="op">&lt;-</span> <span class="st">"ABC_change_balance"</span> <span class="co"># series ID of the set of compo runs</span>
<span class="va">time_units</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"days"</span>, <span class="st">"days"</span><span class="op">)</span> <span class="co"># time units for run (days) and for plots (years)</span>
<span class="va">COMPO_MASTER</span> <span class="op">&lt;-</span> <span class="st">"0_COMPO_MASTER_balance_change.xlsx"</span> <span class="co"># compo master file name</span>
<span class="va">plot_HIDE_BOXES_delta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"SINK"</span><span class="op">)</span> <span class="co"># boxes to hide from evD plot</span>
<span class="va">plot_HIDE_BOXES_size</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"SOURCE"</span>, <span class="st">"SINK"</span><span class="op">)</span> <span class="co"># boxes to hide from evS plot</span>
  
<span class="fu"><a href="../reference/compose_isobxr.html">compose_isobxr</a></span><span class="op">(</span><span class="va">workdir</span>,
               <span class="va">SERIES_ID</span>, 
               <span class="va">time_units</span>,
               <span class="va">COMPO_MASTER</span>, 
               <span class="va">plot_HIDE_BOXES_delta</span>, 
               <span class="va">plot_HIDE_BOXES_size</span><span class="op">)</span></pre></div>
<p>We obtain the following overviews of the evolution of delta values and box sizes over the run duration. By default the plotting functionnality of the <code>compose_isobxr</code> function hides initial run of the composite scenario because it is usually used as a run to let the system artificially relax to it's steady state.<br>
Nevertheless, all the data files edited by the function do include the initial run of the composite scenario.</p>
<p>Below is the plot evDS output of both delta and box sizes over time. <img src="31_CPS_ABC_change_balance_001_p_evDS.png" width="100%"></p>
<p>Below is the facetted plot evD output of delta values in each box over time. <img src="32_CPS_ABC_change_balance_001_pf_evD.png" width="100%"></p>
<p>Below is the facetted plot evS output of box sizes in each box over time. <img src="33_CPS_ABC_change_balance_001_pf_evS.png" width="100%"></p>
</div>
<div id="example-2-changing-the-source-isotope-composition" class="section level2">
<h2 class="hasAnchor">
<a href="#example-2-changing-the-source-isotope-composition" class="anchor"></a>example #2: changing the source isotope composition</h2>
<p>We consider here the same model example of 3 balanced finite boxes in an open system.</p>
<p>In this case, we leave the same balanced flux configuration for the whole duration of the scenario. We also leave the run durations and resolutions unchanged.</p>
<p><img src="35_FORCING_DELTA_ABC_RUN_LIST.png" width="75%"></p>
<p>We however force the delta values of the source box as shown below:</p>
<p><img src="34_FORCING_DELTA_ABC.png" width="50%"></p>
<ol style="list-style-type: decimal">
<li>At runs 1 and 2, we leave the source default delta value (0‰).</li>
<li>At run 3, we change the source default delta value from 0 to + 0.5 ‰.</li>
<li>At run 4, we change the source delta value bcak to 0‰.</li>
</ol>
<p>We call the function as follows:</p>
<div class="sourceCode"><pre class="downlit">
<span class="va">workdir</span> <span class="op">&lt;-</span> <span class="st">"~/DEMO_ABCD"</span> <span class="co"># isobxr and compo master file work. dir.</span>
<span class="va">SERIES_ID</span> <span class="op">&lt;-</span> <span class="st">"ABC_change_source"</span> <span class="co"># series ID of the set of compo runs</span>
<span class="va">time_units</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"days"</span>, <span class="st">"days"</span><span class="op">)</span> <span class="co"># time units for run (days) and for plots (years)</span>
<span class="va">COMPO_MASTER</span> <span class="op">&lt;-</span> <span class="st">"0_COMPO_MASTER_source_change.xlsx"</span> <span class="co"># compo master file name</span>
<span class="va">plot_HIDE_BOXES_delta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"SINK"</span><span class="op">)</span> <span class="co"># boxes to hide from evD plot</span>
<span class="va">plot_HIDE_BOXES_size</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"SOURCE"</span>, <span class="st">"SINK"</span><span class="op">)</span> <span class="co"># boxes to hide from evS plot</span>
  
<span class="fu"><a href="../reference/compose_isobxr.html">compose_isobxr</a></span><span class="op">(</span><span class="va">workdir</span>,
               <span class="va">SERIES_ID</span>, 
               <span class="va">time_units</span>,
               <span class="va">COMPO_MASTER</span>, 
               <span class="va">plot_HIDE_BOXES_delta</span>, 
               <span class="va">plot_HIDE_BOXES_size</span><span class="op">)</span></pre></div>
<p>And for instance, we obtain the following evDS pdf output where we see that the effect of the change in the source isotope composition slightly affects the delta values of A, B and C boxes.</p>
<p><img src="36_0_CPS_ABC_change_source_001_p_evDS.png" width="100%"></p>
<hr>
</div>
</div>
<div id="play-time" class="section level1">
<h1 class="hasAnchor">
<a href="#play-time" class="anchor"></a>Play time</h1>
<p>The user is invited to explore the use of the <strong>compose_isobxr</strong> function by running box models with various settings and input values, from the function arguments but also by adding new entries to the <strong>compose master file</strong>, such as new steps in the composite scenario.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Theo Tacail.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
