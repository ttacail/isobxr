<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Using isobxr • isobxr</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Using isobxr">
<meta property="og:description" content="isobxr">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">isobxr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Demo_ABCD.html">Getting started 1: single runs</a>
    </li>
    <li>
      <a href="../articles/Demo_ABCD_composite.html">Getting started 2: composite runs</a>
    </li>
    <li>
      <a href="../articles/isobxr_vignette.html">Using isobxr</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/ttacail/isobxr/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Using isobxr</h1>
                        <h4 class="author">Théo Tacail</h4>
            
            <h4 class="date">2021-03-12</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/ttacail/isobxr/blob/master/vignettes/isobxr_vignette.Rmd"><code>vignettes/isobxr_vignette.Rmd</code></a></small>
      <div class="hidden name"><code>isobxr_vignette.Rmd</code></div>

    </div>

    
    
<hr>
<p>The <a href="https://ttacail.github.io/isobxr/">isobxr</a> package is a set of R tools designed to perform and explore stable isotope box modeling of open or closed systems. It provides a ready-to-use tool allowing users to develop and test isotopic box models of their system of interest. It allows the user to explore the behavior of these systems in both static (<em>e.g.</em>, at steady state) or dynamic modes (<em>e.g.</em>, in reaction to a perturbation), build complex scenarios, and sweep the space of parameters in both static and dynamic modes.</p>
<hr>
<div id="installation" class="section level1">
<h1 class="hasAnchor">
<a href="#installation" class="anchor"></a>Installation</h1>
<p>The <strong>isobxr</strong> is available as a source package from <a href="https://github.com/">GitHub</a>.</p>
<ol style="list-style-type: decimal">
<li><p>Download and install/update <a href="https://cran.r-project.org/">R</a>.</p></li>
<li><p>Download and install package <strong>devtools</strong></p></li>
</ol>
<div class="sourceCode"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">"devtools"</span><span class="op">)</span></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>Download and install <strong>isobxr</strong> source package.</li>
</ol>
<div class="sourceCode"><pre class="downlit">
<span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://devtools.r-lib.org//reference/remote-reexports.html">install_github</a></span><span class="op">(</span><span class="st">"ttacail/isobxr/isobxr"</span>, build_vignettes <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="co"># FALSE if no pandoc/Rstudio </span></pre></div>
<p>The user is also invited to download the <a href="https://ttacail.github.io/source/demos/0_excel_templates.zip">reference templates</a> for all input and master excel files described in this vignette, as well as download <a href="https://ttacail.github.io/source/demos/1_ABCD.zip">the demonstration files input and master excel files</a> (see <a href="https://ttacail.github.io/isobxr/articles/Demo_ABCD.html">Getting started 1</a> and <a href="https://ttacail.github.io/isobxr/articles/Demo_ABCD_composite.html">Getting started 2</a>).</p>
<p>The <strong>isobxr</strong> package is working under R 3.5.2 to 4.0.3 versions.</p>
<p>It's portability has been proof checked for the following platforms:</p>
<ol style="list-style-type: decimal">
<li><p>Mac OS 10.12.6 &amp; 10.13.6</p></li>
<li><p>Linux (Ubuntu 20.04.1 LTS)</p></li>
<li><p>Windows 10</p></li>
</ol>
<p>You can load the <strong>isobxr</strong> package as follows:</p>
<div class="sourceCode"><pre class="downlit">
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/ttacail/isobxr">isobxr</a></span><span class="op">)</span></pre></div>
<p>Here is the package description of the current version, where you can find the required minimal versions of dependencies:</p>
<div class="sourceCode"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/utils/packageDescription.html">packageDescription</a></span><span class="op">(</span><span class="st">"isobxr"</span><span class="op">)</span>
<span class="co">#&gt; Package: isobxr</span>
<span class="co">#&gt; Type: Package</span>
<span class="co">#&gt; Title: Stable isotope box-modelling in R</span>
<span class="co">#&gt; Version: 0.1.0</span>
<span class="co">#&gt; Authors@R: person("Theo", "Tacail", email = "theo.tacail@gmail.com",</span>
<span class="co">#&gt;         role = c("aut", "cre"))</span>
<span class="co">#&gt; Description: A set of functions to run simple and composite box-models</span>
<span class="co">#&gt;         to describe the dynamic or static distribution of stable</span>
<span class="co">#&gt;         isotopes in open or closed systems. The package also allows the</span>
<span class="co">#&gt;         sweeping of many parameters in both static and dynamic</span>
<span class="co">#&gt;         conditions. It also comes with a post-run plotting interface</span>
<span class="co">#&gt;         built under shiny.</span>
<span class="co">#&gt; Depends: R (&gt;= 3.5.0)</span>
<span class="co">#&gt; License: GPL-3</span>
<span class="co">#&gt; URL: https://github.com/ttacail/isobxr</span>
<span class="co">#&gt; BugReports: https://github.com/ttacail/isobxr/issues</span>
<span class="co">#&gt; Encoding: UTF-8</span>
<span class="co">#&gt; LazyData: true</span>
<span class="co">#&gt; Imports: stringr (&gt;= 1.4.0), readxl (&gt;= 1.3.1), dplyr (&gt;= 1.0.2),</span>
<span class="co">#&gt;         data.table (&gt;= 1.13.2), deSolve (&gt;= 1.28), rlang (&gt;= 0.4.8),</span>
<span class="co">#&gt;         grid (&gt;= 4.0.3), metR (&gt;= 0.7.0), beepr (&gt;= 1.3), shiny (&gt;=</span>
<span class="co">#&gt;         1.5.0), shinyFiles (&gt;= 0.8.0), shinythemes (&gt;= 1.1.2), shinyjs</span>
<span class="co">#&gt;         (&gt;= 2.0.0), DT (&gt;= 0.16), ggplot2 (&gt;= 3.3.2), ggrepel (&gt;=</span>
<span class="co">#&gt;         0.8.2), qgraph (&gt;= 1.6.5), writexl (&gt;= 1.3.1)</span>
<span class="co">#&gt; RoxygenNote: 7.1.1</span>
<span class="co">#&gt; Suggests: knitr, rmarkdown, devtools</span>
<span class="co">#&gt; VignetteBuilder: knitr</span>
<span class="co">#&gt; Author: Theo Tacail [aut, cre]</span>
<span class="co">#&gt; Maintainer: Theo Tacail &lt;theo.tacail@gmail.com&gt;</span>
<span class="co">#&gt; Built: R 4.0.3; ; 2021-03-12 17:21:47 UTC; unix</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; -- File: /private/var/folders/bj/pyh7pv4922973yvnx5jyvps1f6vt0y/T/Rtmpmfsz8u/temp_libpath3a362e8b7ea9/isobxr/Meta/package.rds</span></pre></div>
<p>You can locally browse the vignette as follows:</p>
<div class="sourceCode"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/utils/browseVignettes.html">browseVignettes</a></span><span class="op">(</span><span class="st">"isobxr"</span><span class="op">)</span></pre></div>
<hr>
</div>
<div id="theory-of-box-modeling-and-formalism" class="section level1">
<h1 class="hasAnchor">
<a href="#theory-of-box-modeling-and-formalism" class="anchor"></a>Theory of box modeling and formalism</h1>
<dl>
<dt>The theory and formalism shown in this section is derived from the chapter 7 (<em>Dynamic systems</em>) of</dt>
<dd>
<p>Albarède, F., 1995. Introduction to Geochemical Modeling. Cambridge University Press, Cambridge.<br><a href="https://doi.org/10.1017/CBO9780511622960" class="uri">https://doi.org/10.1017/CBO9780511622960</a></p>
</dd>
</dl>
<div id="principles-of-stable-isotopes-box-modeling" class="section level2">
<h2 class="hasAnchor">
<a href="#principles-of-stable-isotopes-box-modeling" class="anchor"></a>Principles of stable isotopes box modeling</h2>
<p>We consider a system consisting of <span class="math inline">\(n\)</span> boxes <span class="math inline">\(j\)</span>, exchanging an element <strong>X</strong> that has at least two stable isotopes <span class="math inline">\(M\)</span> and <span class="math inline">\(N\)</span>. Any box <span class="math inline">\(i\)</span> is defined by:</p>
<ul>
<li>
<span class="math inline">\(m^X_i\)</span> the mass of element <strong>X</strong> in box <span class="math inline">\(i\)</span> - also refered to as <strong>box size</strong> thereafter</li>
<li>
<span class="math inline">\(m^M_i\)</span> and <span class="math inline">\(m^N_i\)</span> the masses of isotopes <span class="math inline">\(M\)</span> and <span class="math inline">\(N\)</span> in box <span class="math inline">\(i\)</span>, respectively</li>
<li>
<span class="math inline">\(J_{i \mapsto j}^X\)</span> is the massic flux of <strong>X</strong> from <span class="math inline">\(i\)</span> to <span class="math inline">\(j\)</span> (homogeneous to a mass per time unit)</li>
</ul>
<p><img src="0_Box_model_principle.png" width="100%"></p>
<p>We call <span class="math inline">\(R_i\)</span> the <span class="math inline">\(M/N\)</span> isotope abundance ratio: <span class="math display">\[R_i = \left(\dfrac{n^M}{n^N}\right)_i = \left(\dfrac{m^M}{m^N}\right)_i \times \left(\dfrac{M^N}{M^M}\right) =   \left(\dfrac{m^M}{m^N}\right)_i A \]</span> where</p>
<ul>
<li>
<span class="math inline">\(n^M_i\)</span> and <span class="math inline">\(n^N_i\)</span> are the molar quantities of isotopes <span class="math inline">\(M\)</span> and <span class="math inline">\(N\)</span> in box <span class="math inline">\(i\)</span>
</li>
<li>
<span class="math inline">\(M^M\)</span> and <span class="math inline">\(M^N\)</span> are the molar masses of isotopes <span class="math inline">\(M\)</span> and <span class="math inline">\(N\)</span> in box <span class="math inline">\(i\)</span>
</li>
<li>
<span class="math inline">\(A = \left(\frac{M^N}{M^M}\right)\)</span> the ratio of the molar masses of <span class="math inline">\(N\)</span> and <span class="math inline">\(M\)</span>.</li>
</ul>
<p>Finally, we define <span class="math inline">\(D_{i \mapsto j}^{M/N}\)</span> the relative fractionation coefficient between M and N from <span class="math inline">\(i\)</span> to <span class="math inline">\(j\)</span>:</p>
<p><span class="math display">\[D_{i \mapsto j}^{M/N} = \dfrac{{J_{i \mapsto j}^M}/{J_{i \mapsto j}^N}}{m^M_i/m^N_i}\]</span></p>
<p>The principe of modeling the system consists now in predicting the evolution of <strong>box sizes</strong> (<span class="math inline">\(m^X_i\)</span>) during time and the evolution of the <strong>isotope ratios</strong> (<span class="math inline">\(R_i\)</span>), knowing the fluxes, initial box sizes and fractionation coefficients.</p>
</div>
<div id="mass-conservation-of-element-x" class="section level2">
<h2 class="hasAnchor">
<a href="#mass-conservation-of-element-x" class="anchor"></a>Mass conservation of element X</h2>
<p>Considering <strong>X</strong> has <strong>no radioactive nor radiogenic component</strong>, mass conservation for element <strong>X</strong> reads :</p>
<p><span class="math display">\[\dfrac{dm^X_i}{dt} = - \sum \limits_{j\neq i} J_{i \mapsto j}^X + \sum \limits_{j\neq i} J_{j \mapsto i}^X\]</span></p>
<p>This equation can be integrated in its linear form considering constant fluxes as follows:</p>
<p><span class="math display">\[m^X_i = \left(- \sum \limits_{j\neq i} J_{i \mapsto j}^X + \sum \limits_{j\neq i} J_{j \mapsto i}^X\right) \times t + m^X_{i, t_0}\]</span></p>
<p>where <span class="math inline">\(m^X_{i, t_0}\)</span> is the mass of element <strong>X</strong> in box <span class="math inline">\(i\)</span> at t = 0.</p>
</div>
<div id="system-of-differential-equations-for-stable-isotope-ratios" class="section level2">
<h2 class="hasAnchor">
<a href="#system-of-differential-equations-for-stable-isotope-ratios" class="anchor"></a>System of differential equations for stable isotope ratios</h2>
<p>Considering <span class="math inline">\(N\)</span> and <span class="math inline">\(M\)</span> are stable and non radiogenic, mass conservation reads :</p>
<p><span class="math display">\[\dfrac{dm^N_i}{dt} = - \sum \limits_{j\neq i} J_{i \mapsto j}^N + \sum \limits_{j\neq i} J_{j \mapsto i}^N = - \sum \limits_{j\neq i} \dfrac{J_{i \mapsto j}^N}{m^N_i} m^N_i + \sum \limits_{j\neq i} \dfrac{J_{j \mapsto i}^N}{m^N_j} m^N_j\]</span></p>
<p>Likewise,</p>
<p><span class="math display">\[\dfrac{dm^M_i}{dt} = - \sum \limits_{j\neq i} \dfrac{J_{i \mapsto j}^M}{m^M_i} m^M_i + \sum \limits_{j\neq i} \dfrac{J_{j \mapsto i}^M}{m^M_j} m^M_j\]</span></p>
<p>We can meanwhile derive the ratio <span class="math inline">\(R_i\)</span> as :</p>
<p><span class="math display">\[\dfrac{dR_i}{dt} = \dfrac{d}{dt}\left(\dfrac{m^M}{m^N}\right)_i A  = \dfrac{A}{{m^N_i}^2} \left(m^N_i\dfrac{dm^M_i}{dt} - m^M_i \dfrac{dm^N_i}{dt}\right) = \dfrac{A}{m^N_i} \left(\dfrac{dm^M_i}{dt} - \dfrac{R_i}{A} \dfrac{dm^N_i}{dt}\right)\]</span></p>
<p>We can insert mass conservation deriative into previous relationship:</p>
<p><span class="math display">\[\dfrac{dR_i}{dt} = \dfrac{A}{m^N_i} \left(- \sum \limits_{j\neq i} \dfrac{J_{i \mapsto j}^M}{m^M_i} m^M_i + \sum \limits_{j\neq i} \dfrac{J_{j \mapsto i}^M}{m^M_j} m^M_j + \dfrac{R_i}{A}  \sum \limits_{j\neq i} \dfrac{J_{i \mapsto j}^N}{m^N_i} m^N_i - \dfrac{R_i}{A}  \sum \limits_{j\neq i} \dfrac{J_{j \mapsto i}^N}{m^N_j} m^N_j   \right)\]</span></p>
<p>Modified as such :</p>
<p><span class="math display">\[\dfrac{dR_i}{dt} = A \left(- \sum \limits_{j\neq i} \dfrac{J_{i \mapsto j}^M}{m^M_i} \dfrac{m^M_i}{m^N_i} + \sum \limits_{j\neq i} \dfrac{J_{j \mapsto i}^M}{m^M_j} \dfrac{m^M_j}{m^N_j} \dfrac{m^N_j}{m^N_i} + \dfrac{R_i}{A} \sum \limits_{j\neq i} \dfrac{J_{i \mapsto j}^N}{m^N_i} - \dfrac{R_i}{A} \sum \limits_{j\neq i} \dfrac{J_{j \mapsto i}^N}{m^N_j} \dfrac{m^N_j}{m^N_i}   \right)\]</span></p>
<p><span class="math display">\[\dfrac{dR_i}{dt} = A \left(- \sum \limits_{j\neq i} \dfrac{J_{i \mapsto j}^M}{m^M_i} \dfrac{R_i}{A} + \sum \limits_{j\neq i} \dfrac{J_{j \mapsto i}^M}{m^M_j} \dfrac{R_j}{A} \dfrac{m^N_j}{m^N_i} + \dfrac{R_i}{A} \sum \limits_{j\neq i} \dfrac{J_{i \mapsto j}^N}{m^N_i} - \dfrac{R_i}{A} \sum \limits_{j\neq i} \dfrac{J_{j \mapsto i}^N}{m^N_j} \dfrac{m^N_j}{m^N_i}   \right)\]</span></p>
<p><span class="math display">\[\dfrac{dR_i}{dt}  = R_i \sum \limits_{j \neq i} \left(\dfrac{J^N_{i \mapsto j}}{m^N_i} - \dfrac{J^M_{i \mapsto j}}{m^M_i} \right) +  \sum \limits_{j \neq i} \dfrac{J^M_{j \mapsto i}}{m^M_j} \dfrac{m^N_j}{m^N_i} R_j - \sum \limits_{j \neq i}  \dfrac{J^N_{j \mapsto i}}{m^N_j} \dfrac{m^N_j}{m^N_i} R_i\]</span></p>
<p><span class="math display">\[\dfrac{dR_i}{dt} = R_i \sum \limits_{j \neq i} \left(\dfrac{J^N_{i \mapsto j}}{m^N_i} - \dfrac{J^M_{i \mapsto j}}{m^M_i} \right) +  
\sum \limits_{j \neq i} \left( \dfrac{J^M_{j \mapsto i}}{m^M_j} R_j - \dfrac{J^N_{j \mapsto i}}{m^N_j} R_i \right) \dfrac{m^N_j}{m^N_i}\]</span></p>
<p><span class="math display">\[\dfrac{dR_i}{dt} = 
R_i \sum \limits_{j \neq i} \dfrac{J_{i \mapsto j}^N}{m^N_i} \left(1- \dfrac{{J_{i \mapsto j}^M}/{J_{i \mapsto j}^N}}{{m^M_i}/{m^N_i}}\right) + \sum \limits_{j \neq i} \dfrac{J_{j \mapsto i}^N}{m^N_j} \left(\dfrac{{J_{j \mapsto i}^M}/{J_{j \mapsto i}^N}}{m^M_j / m^N_j} R_j - R_i \right) \dfrac{m^N_j}{m^N_i}\]</span></p>
<p>Resulting in :</p>
<p><span class="math display">\[\dfrac{dR_i}{dt} = 
R_i \sum \limits_{j \neq i} \dfrac{J_{i \mapsto j}^N}{m^N_i} \left(1- D_{i \mapsto j}^{M/N} \right) + \sum \limits_{j \neq i} \dfrac{J_{j \mapsto i}^N}{m^N_j} \left(D_{j \mapsto i}^{M/N} R_j - R_i \right) \dfrac{m^N_j}{m^N_i}\]</span></p>
<p>In order to solve this equation, we assume that:</p>
<p><span class="math display">\[\begin{array}{ccccc}
\dfrac{J_{i \mapsto j}^N}{m^N_i} \simeq \dfrac{J_{i \mapsto j}^X}{m^X_i} &amp; , &amp;
\dfrac{J_{j \mapsto i}^N}{m^N_j} \simeq \dfrac{J_{j \mapsto i}^X}{m^X_j} &amp; , &amp;
\dfrac{m^N_j}{m^N_i} \simeq \dfrac{m^X_j}{m^X_i}
\end{array}\]</span></p>
<p>These assumptions are valid for amplitude of stable isotope fractionations of the order of tens of ‰. This assumption finds its limitation in the case of ample stable isotope fractionations of isotopic systems of light elements (such as D/H).</p>
<p>In these cases, the differences in reactivities can be too great and amplitudes of stable isotope fractionations too marked for the assumptions to be applicable.</p>
<p>We thus have the following system of first order differential equations used thereafter:</p>
<p><span class="math display">\[
\dfrac{dR_i}{dt} = 
R_i \sum \limits_{j \neq i} \dfrac{J_{i \mapsto j}^X}{m^X_i} \left(1- D_{i \mapsto j}^{M/N} \right) + \sum \limits_{j \neq i} \dfrac{J_{j \mapsto i}^X}{m^X_j} \left(D_{j \mapsto i}^{M/N} R_j - R_i \right) \dfrac{m^X_j}{m^X_i}
\]</span></p>
<p>This system can be solved in order to reconstruct the evolution of stable isotope ratios <span class="math inline">\(R_i(t)\)</span> in each box over time. Two main situations can be distinguished here.</p>
<ol style="list-style-type: decimal">
<li><p>The inward and outward fluxes of element <strong>X</strong> for any given box are <strong>balanced</strong> (<em>i.e.</em> <span class="math inline">\({dm^X_i}/{dt} = 0\)</span> for all boxes). All box sizes (<span class="math inline">\(m^X_i\)</span>) are thus constants.</p></li>
<li><p>The inward and outward fluxes of element <strong>X</strong> for at least one box is <strong>unbalanced</strong> (<em>i.e.</em> <span class="math inline">\({dm^X_i}/{dt} \neq 0\)</span> for at least one box). Thus, at least one box displays a varying mass of element <strong>X</strong> with time (<span class="math inline">\(m^X_i(t)\)</span>).</p></li>
</ol>
<p>In the first case, the reconstruction of <span class="math inline">\(R_i(t)\)</span> only requires the solving of the system of ordinary first order differential equations. This can be done analytically <em>via</em> the algebric inversion of the equation system matrix. This is what the <code>ana_slvr</code> core functions does.</p>
<p>In the second case, the reconstruction of <span class="math inline">\(R_i(t)\)</span> requires the simultaneous solving of the system of ordinary first order differential equations describing <span class="math inline">\(R_i(t)\)</span> and of the derivative of <span class="math inline">\(m^X_i(t)\)</span> (with a linear solution). This is performed numerically <em>via</em> an incremental integration as done by the <code>num_slvr</code> core function.</p>
<p>All <span class="math inline">\(R_i(t)\)</span> stable isotope ratios can be also expressed as <span class="math inline">\(\delta_i(t)\)</span> values expressed in the ‰ unit, defined as follows and where <span class="math inline">\(R_{std}\)</span> is the stable isotope ratio of the standard or reference material:</p>
<p><span class="math display">\[\delta^{M/N}X_i(t) = \left(\dfrac{R_i(t)}{R_{std}} - 1\right) \times 1000 \]</span></p>
<hr>
</div>
</div>
<div id="the-isobxr-solvers-of-stable-isotope-box-models" class="section level1">
<h1 class="hasAnchor">
<a href="#the-isobxr-solvers-of-stable-isotope-box-models" class="anchor"></a>The isobxr solvers of stable isotope box models</h1>
<p>The <strong>isobxr</strong> package uses two core solver functions to solve the system of differential equations: <strong>num_slvr</strong> and <strong>ana_slvr</strong>. These functions are called within broader functions and are not designed to be directly used by users themselves, although this remains possible. Nonetheless, because these functions are the actual solvers of the stable isotope box model equation systems, you will find here a description of their functionning as well as their inputs and outputs.</p>
<p>You can also refer to the documentation for these two functions by typing the following code into your R console:</p>
<div class="sourceCode"><pre class="downlit">
<span class="op">?</span><span class="va">ana_slvr</span>
<span class="op">?</span><span class="va">num_slvr</span></pre></div>
<div id="structure-and-format-required-for-the-input-files" class="section level2">
<h2 class="hasAnchor">
<a href="#structure-and-format-required-for-the-input-files" class="anchor"></a>Structure and format required for the <em>input files</em>
</h2>
<p>The <em>input file</em> is the (xlsx) document containing all input data allowing both <code>ana_slvr</code> and <code>num_slvr</code> to run. Its format and name are standardized and should not be altered. Its direct modification by user is not required because <em>input files</em> are edited by the broader and user-friendly <code>run_isobxr</code> function, described in another section of this vignette.</p>
<div id="input-file-name" class="section level4">
<h4 class="hasAnchor">
<a href="#input-file-name" class="anchor"></a><strong>Input file name</strong>
</h4>
<ul>
<li>The <em>input file</em> is an xlsx file.<br>
</li>
<li>The <em>input file</em> name needs to end with the following: [ _INPUT.xlsx ].<br>
</li>
<li>The <em>input file</em> name structure is [ RUN name + _INPUT.xlsx ].<br>
</li>
<li>
<em>Example</em>: [ TEST_RUN_INPUT.xlsx ]</li>
</ul>
</div>
<div id="input-file-structure" class="section level4">
<h4 class="hasAnchor">
<a href="#input-file-structure" class="anchor"></a><strong>Input file structure</strong>
</h4>
<p>The <em>input file</em> contains at least the 4 following sheet strictly named as follows:</p>
<ol style="list-style-type: decimal">
<li>
<strong>CONSTS</strong>: Sheet documenting the constants<br>
</li>
<li>
<strong>INITIAL</strong>: Sheet documenting the initial conditions of all box sizes (even empty ones) and all initial delta values.</li>
<li>
<strong>FLUXES</strong>: Sheet documenting the massic fluxes of element X between all boxes (structured as a matrix)</li>
<li>
<strong>COEFFS</strong>: Sheet documenting the isotopic fractionation coefficients between all boxes (structured as a matrix)</li>
</ol>
</div>
<div id="consts-sheet" class="section level4">
<h4 class="hasAnchor">
<a href="#consts-sheet" class="anchor"></a><strong>CONSTS</strong> sheet</h4>
<p><img src="1_FORMAT_INPUT_CONSTS.png" width="40%"></p>
<p>The <strong>CONSTS</strong> sheet should be strictly structured as shown here.</p>
<p>All <em>text in black</em> has to be strictly the same as shown.</p>
<p>All <em>italicized and red text</em> corresponds to numerical or litteral variables set by the user:</p>
<ul>
<li>
<strong>X</strong> is the element of interest. Example: Ca<br>
</li>
<li>
<strong>M</strong> is the numerator isotope. Example: 44<br>
</li>
<li>
<strong>N</strong> is the denominator isotope. Example: 42<br>
</li>
<li>
<strong><span class="math inline">\(R_{std}\)</span></strong> is the isotope ratio of a standard or reference material, used to express the delta value. Example: 3.20297<br>
</li>
<li>
<strong>time</strong> is the <strong>duration of the run</strong>, expressed in the same time units as the fluxes (expressed in mass unit per time unit). Example: 365 (days in case fluxes are expressed in mass of element per day)</li>
<li>
<strong>nb_steps</strong> is the <strong>run resolution</strong>, <em>i.e.</em> the number of iterations to do within the run duration. Example: 365 (1 calculated state of the system per day)</li>
</ul>
</div>
<div id="initial-sheet" class="section level4">
<h4 class="hasAnchor">
<a href="#initial-sheet" class="anchor"></a><strong>INITIAL</strong> sheet</h4>
<p><img src="2_FORMAT_INPUT_INITIAL.png" width="40%"></p>
<p>The <strong>INITIAL</strong> sheet should be strictly structured as shown here.</p>
<p>All <em>text in black</em> has to be strictly the same as shown.</p>
<p>All <em>blue text</em> corresponds to litteral names of the <em>n</em> boxes defined by user.</p>
<ul>
<li>These names should be coherent with all other references to box names (as in <strong>FLUXES</strong> or <strong>COEFFS</strong> sheet).<br>
</li>
<li>Two or more boxes can not have the exact same name.<br>
</li>
<li>The user should avoid the use of numerical values in the box names.<br>
</li>
<li>The user should avoid the use of spaces or special characters, with the exception of the underscore "_".<br>
</li>
<li><p>The user should chose abbvreviated names (preferabily 3 characters, for the sake of clarity in diagrams and plots).</p></li>
<li>Example of lists of box names:
<ul>
<li>OCEAN, MTLE, C_CRUST, O_CRUST, RVR for ocean, mantle, continental crust, oceanic crust and river boxes respectively</li>
<li>DIET, MUSCLE, KDN, BONE, UR for diet, muscle, river, bone and urine boxes respectively</li>
</ul>
</li>
</ul>
<p>All <em>italicized and red text</em> corresponds to numerical variables set by the user:</p>
<ul>
<li>In the column <strong>SIZE_INIT</strong> (box sizes at initial state): <span class="math inline">\(m_{BOX\_i, t_0}\)</span> corresponds to the mass of element <strong>X</strong> in box <em>i</em> at <em>t = 0</em>. These values are null or positive real numbers.</li>
<li>In the column <strong>DELTA_INIT</strong> (box delta values at initial state): <span class="math inline">\(\delta_{BOX\_i, t_0}\)</span> corresponds to the delta value in box <em>i</em> at <em>t = 0</em>. These values are real numbers.</li>
</ul>
</div>
<div id="fluxes-sheet" class="section level4">
<h4 class="hasAnchor">
<a href="#fluxes-sheet" class="anchor"></a><strong>FLUXES</strong> sheet</h4>
<p><img src="3_FORMAT_INPUT_FLUXES.png" width="75%"></p>
<p>The <strong>FLUXES</strong> sheet should be strictly structured as shown here.</p>
<p>All <em>text in black</em> has to be strictly the same as shown (<strong>BOXES_ID</strong> here).</p>
<p>All <em>blue text</em> corresponds to exact same litteral names of the <em>n</em> boxes as defined by the user in <strong>INITIAL</strong> sheet, in the same vertical and horizontal order as in <strong>INITIAL</strong> sheet.</p>
<p>All <em>italicized and red text</em> corresponds to numerical variables set by the user:</p>
<ul>
<li>
<span class="math inline">\(F_{i \to j}\)</span> corresponds to flux of element <strong>X</strong> from box <em>i</em> to box <em>j</em><br>
(equivalent to <span class="math inline">\(J_{i \mapsto j}^X\)</span> in the system of differential equations as described above).<br>
These values are null or positive real numbers.</li>
</ul>
</div>
<div id="coeffs-sheet" class="section level4">
<h4 class="hasAnchor">
<a href="#coeffs-sheet" class="anchor"></a><strong>COEFFS</strong> sheet</h4>
<p><img src="4_FORMAT_INPUT_COEFFS.png" width="75%"></p>
<p>The <strong>COEFFS</strong> sheet should be strictly structured as shown here.</p>
<p>All <em>text in black</em> has to be strictly the same as shown (<strong>BOXES_ID</strong> here).</p>
<p>All <em>blue text</em> corresponds to exact same litteral names of the <em>n</em> boxes as defined by the user in <strong>INITIAL</strong> sheet, in the same vertical and horizontal order as in <strong>INITIAL</strong> sheet.</p>
<p>All <em>italicized and red text</em> corresponds to numerical variables set by the user:</p>
<ul>
<li>
<span class="math inline">\(\alpha_{i \to j}\)</span> corresponds to isotope fractionation coefficient from box <em>i</em> to box <em>j</em><br>
(equivalent to <span class="math inline">\(D_{i \mapsto j}^X\)</span> in the system of differential equations as described above).<br>
These values are stricly positive real numbers.</li>
</ul>
</div>
</div>
<div id="numerical-solver-num_slvr" class="section level2">
<h2 class="hasAnchor">
<a href="#numerical-solver-num_slvr" class="anchor"></a>Numerical solver (<code>num_slvr</code>)</h2>
<p>The numerical solver <code>num_slvr</code> iteratively integrates the derivatives of the box sizes (<span class="math inline">\(\frac{dm^X_i}{dt}\)</span>) and isotope ratios (<span class="math inline">\(\frac{dR_i}{dt}\)</span>) over the whole run duration. The <code>num_slvr</code> uses the <code>ode</code> ordinary differential equation integrating function from the <strong>deSolve</strong> package.</p>
<div id="applicability" class="section level4">
<h4 class="hasAnchor">
<a href="#applicability" class="anchor"></a>Applicability</h4>
<p>This function solves both the evolution of isotope ratios and box sizes in each box defined by user. The <code>num_slvr</code> function therefore can be used in two distinct sitation:</p>
<ol style="list-style-type: decimal">
<li><p>In the case of balanced fluxes of element <strong>X</strong> between all involved boxes.<br>
The derivative of box sizes will be null (<span class="math inline">\(\frac{dm^X_i}{dt} = 0\)</span>), in other words all box sizes will be constant.</p></li>
<li><p>In the case of unbalanced fluxes of element <strong>X</strong> for at least one box of the system.<br>
The derivative of box sizes will be non null in at least one case (<span class="math inline">\(\frac{dm^X_i}{dt} \neq 0\)</span>), in other words at least on box loses and accumulates the element X.</p></li>
</ol>
<p>The drawbacks of this function is that</p>
<ul>
<li>Its accuracy depends on the time resolution of the run.</li>
<li>The calculation can be time consuming.<br>
</li>
<li>We miss information on the system dynamics, which an analytical solver could bring.</li>
</ul>
<p>The use of this function is thus preferred in the case of unbalanced fluxes, where at least one box loses or accumulates the element <strong>X</strong> over time (case #2). It then allows to study the dynamic responses of a system to a perturbation of the flux balance for at least one box.</p>
</div>
<div id="using-num_slvr" class="section level4">
<h4 class="hasAnchor">
<a href="#using-num_slvr" class="anchor"></a>Using num_slvr</h4>
<p><em>Remark</em>: The direct use of <code>num_slvr</code> function by user is not encouraged since this function is integrated in the global <code>run_isobxr</code> function described thereafter.</p>
<p>The <code>num_slvr</code> function reads an INPUT file (file name structure: RUN name + _INPUT.xlsx, format described in detail below) containing all commands and conditions for the required model run, namely:</p>
<ul>
<li>
<em>Constants</em> defining the system (Element symbol, isotopes considered, standard or reference material isotope ratio, run duration and number of time steps)<br>
</li>
<li>
<em>Initial conditions</em> where each box is associated to an initial size (mass of element X) and an initial isotope composition expressed in delta value (‰ unit)<br>
</li>
<li>A matrix <em>fluxes</em> of element <strong>X</strong> between all boxes of the system (in mass unit per time unit)<br>
</li>
<li>A matrix of <em>isotope fractionation coefficients</em> associated to all boxes of the system</li>
</ul>
<p>The <code>num_slvr</code> function returns the numerically determined evolution of the stable isotope compositions and box sizes <strong>X</strong> in all boxes over the run duration. The detailed outputs are as follows:</p>
<ul>
<li>OUT data file storing initial and final size and delta values in each box.<br>
(file name structure: RUN name + _N_1_OUT.csv)</li>
<li>evS data file storing the evolution with time of the sizes (masses of element X) of each box.<br>
(file name structure: RUN name + _N_2_evS.csv)</li>
<li>evD data file storing the evolution with time of the delta values in each box.<br>
(file name structure: RUN name + _N_3_evD.csv)</li>
</ul>
</div>
</div>
<div id="analytical-solver-ana_slvr" class="section level2">
<h2 class="hasAnchor">
<a href="#analytical-solver-ana_slvr" class="anchor"></a>Analytical solver (<code>ana_slvr</code>)</h2>
<p>The analytical solver <code>ana_slvr</code> calculates the analytical solutions of the system of ordinary differential equations (ODES) of stable isotope ratios of an element <strong>X</strong> in all boxes. It determines the eigenvalues, eigenvectors and constants defined by initial conditions associated to the ODES, and allows to determine the expression of stable isotope ratios as a function of time.</p>
<div id="applicability-1" class="section level4">
<h4 class="hasAnchor">
<a href="#applicability-1" class="anchor"></a>Applicability</h4>
<p>In this case, the box sizes are considered as constant since the solving of the system of differential equations only considers the isotope ratios as functions of time. In other words, in the case with balanced inward and outward fluxes for all boxes (<span class="math inline">\(\frac{dm^X_i}{dt} = 0\)</span>), this function allows to accurately determine the expression of the stable isotope ratio in a given box as a function of time. The function also edits a data set of the evolution of isotope compositions in each box over the time range and with the time resolution determined by the user.</p>
<p>The use of this function is thus not applicable in the case of unbalanced fluxes for one box or more, with the exception of boxes defined as source or sinks (or waste) in the case of open systems, as described in the model design section thereafter.</p>
</div>
<div id="using-ana_slvr" class="section level4">
<h4 class="hasAnchor">
<a href="#using-ana_slvr" class="anchor"></a>Using ana_slvr</h4>
<p><em>Remark</em>: The direct use of <code>ana_slvr</code> function by user is not encouraged since this function is integrated in the global <code>run_isobxr</code> function described thereafter.</p>
<p>The <code>ana_slvr</code> function reads an INPUT file (file name structure: RUN_ID + INPUT.xlsx, format described in detail below) containing all commands and conditions for the required model run, namely:</p>
<ul>
<li>
<em>Constants</em> defining the system (Element symbol, isotopes considered, standard or reference material isotope ratio, run duration and number of time steps)<br>
</li>
<li>
<em>Initial conditions</em> where each box is associated to an initial size (mass of element X) and an initial isotope composition expressed in delta value (‰ unit)<br>
</li>
<li>A matrix <em>fluxes</em> of element <strong>X</strong> between all boxes of the system (in mass unit per time unit)<br>
</li>
<li>A matrix of <em>isotope fractionation coefficients</em> associated to all boxes of the system</li>
</ul>
<p>The <code>ana_slvr</code> function returns the analytical solutions of the stable isotope ratios as well as the evolution of the delta values (in ‰, relative to the reference material). The detailed outputs are as follows:</p>
<ul>
<li>OUT data file with initial and final size and delta values in each box.<br>
(file name structure: RUN name + _A_1_OUT.csv)</li>
<li>ODE_SOLNs data file summarizing outputs of the analytical solutions of the ODES (eigenvalues, eigenvectors, relaxation times, constants according to initial conditions).<br>
(file name structure: RUN name + _A_2_ODE_SOLNs.csv)</li>
<li>evD data file of the evolution with time of the delta values in each box.<br>
(file name structure: RUN name + _A_3_evD.csv)</li>
</ul>
<hr>
</div>
</div>
</div>
<div id="running-isobxr-box-models-with-run_isobxr" class="section level1">
<h1 class="hasAnchor">
<a href="#running-isobxr-box-models-with-run_isobxr" class="anchor"></a>Running isobxr box models with <code>run_isobxr</code>
</h1>
<div id="how-does-run_isobxr-work" class="section level2">
<h2 class="hasAnchor">
<a href="#how-does-run_isobxr-work" class="anchor"></a>How does <code>run_isobxr</code> work?</h2>
<p>The <code>run_isobxr</code> function allows to run the <strong>isobxr</strong> stable isotope box model, assess and render the design of the model and automatically run <code>num_slvr</code> or <code>ana_slvr</code> depending on the model design.</p>
<p>As defined in the documentation, <code>run_isobxr</code> takes a series of inputs from a working directory as well as from the user in the console, it stores a track of all the run conditions both in run specific files and in a global LOG file, and it returns several outputs files to an automatically created and managed directory and subdirectories.</p>
<p>To find the detailed description of <code>run_isobxr</code> inputs and outputs, refer to its documentation:</p>
<div class="sourceCode"><pre class="downlit">
<span class="co"># To see documentation on run_isobxr function, type in console:</span>
<span class="op">?</span><span class="va">run_isobxr</span></pre></div>
<p>The <code>run_isobxr</code> general principle is shown in following diagram.</p>
<p><img src="9_run_isobxr_directory_structure.png" width="75%"></p>
<ol style="list-style-type: decimal">
<li>The <code>run_isobxr</code> function first extracts the configuration of the system (boxes, fluxes, fractionation coefficients) and of the given run (run duration, initial conditions).
<ol style="list-style-type: lower-roman">
<li>These parameters come in majority from the <em>isobxr master file</em> (isotope system details, boxes details, flux and fractionation coefficient lists).</li>
<li>Run specific parameters are directly set as parameters of the function (run duration, run resolution, time units for the plot).</li>
<li>Optional parameters allow the manual forcing of some parameters (FORCING_RAYLEIGH, FORCING_SIZE, FORCING_DELTA, FORCING_ALPHA).</li>
</ol>
</li>
<li>The <code>run_isobxr</code> function then evaluates the general design of the box model.
<ol style="list-style-type: lower-roman">
<li>It will ignore boxes possibly named by user but isolated from the general system (no inward nor outward fluxes).<br>
</li>
<li>It will determine if the system is closed or open by identifying the presence/absence of boxes with the <strong>INFINITE</strong> status.
<ul>
<li>In the case of a closed system, <em>i.e.</em> with no declared <strong>INFINITE</strong> boxes, it will display the following message in the console:
<ul>
<li>
<strong>&lt; All boxes are FINITE &gt;</strong><br>
</li>
</ul>
</li>
<li>In the case of an open system, <em>i.e.</em> with declared <strong>INFINITE</strong> boxes, it will display the list of infinite boxes in the console:
<ul>
<li>
<strong>&lt; The INFINITE boxes are ... BOX_i ... &gt;</strong><br>
</li>
</ul>
</li>
</ul>
</li>
<li>It will then determine whether some finite boxes are out of balance (unbalanced inward/outward fluxes).
<ul>
<li>In the case of a globally balanced system, <em>i.e.</em> no out of balance finite boxes, no message will be printed in the console.</li>
<li>In the case of a system with at least one unbalanced finite box, it will display a message for each unbalanced finite box in the console:
<ul>
<li>
<strong>&lt; BOX_i IN/OUT is pos &gt;</strong> if the balance of box <em>i</em> is positive (accumulation of X)<br>
</li>
<li>
<strong>&lt; BOX_i IN/OUT is neg (max run: empty_duration t units) &gt;</strong> if the balance of box <em>i</em> is negative (loss of X). It will also display the maximum duration of the run until the box is totally emptied.</li>
</ul>
</li>
</ul>
</li>
</ol>
</li>
<li>On this basis, the <code>run_isobxr</code> function then determines which solver function to run:
<ol style="list-style-type: lower-roman">
<li>
<code>ana_slvr</code> if all finite boxes have balanced inward and outward fluxes. It will then display the following message:<br><strong>&lt; Running num_slvr (BALANCED FINITE BOXES) &gt;</strong>
</li>
<li>
<code>num_slvr</code> if at least one finite box has unbalanced inward and outward fluxes. It will then display the following message:<br><strong>&lt; Running ana_slvr (UNBALANCED FINITE BOXES) &gt;</strong>
</li>
</ol>
</li>
</ol>
<dl>
<dt><strong>remark</strong></dt>
<dd>in the case of a system with at least one unbalanced finite box with a negative balance of inward/outward fluxes, the function evaluates whether the run duration excedes the shortest duration of emptying of the finite boxes with a negative balance. If a box matches this criteria, the function will automatically reset the total run duration (<em>e.g.</em>, <em>t_max</em>) to the duration of emptying of this box (<em>e.g.</em>, <em>updated_t_max</em>). A warning will be printed. This warning message can not be hidden by the PRINT_HIDE parameter.
</dd>
</dl>
<pre><code>#&gt; [1] "*** UPDATED TOTAL RUN TIME *** &lt; Total run time has been changed from t_max to updated_t_max (limiting box: Box_i) &gt;"</code></pre>
</div>
<div id="format-of-the-isobxr-master-file" class="section level2">
<h2 class="hasAnchor">
<a href="#format-of-the-isobxr-master-file" class="anchor"></a>Format of the <em>isobxr master file</em>
</h2>
<p>All the functions designed to be directly used by users (<code>run_isobxr</code>, <code>compose_isobxr</code>, <code>sweep_steady</code>, <code>sweep_dyn</code>) are meant to be run in relation with an <em>isobxr master file</em>.</p>
<p>The <em>isobxr master file</em> is the (xlsx) document containing all input data allowing <code>run_isobxr</code> function to perform single runs, and is required alongside specific complementary files for functions performing multiple runs (<code>compose_isobxr</code>, <code>sweep_steady</code>, <code>sweep_dyn</code>).</p>
<p>It is where the user sets the design of their model:</p>
<ul>
<li>define the isotopic system<br>
</li>
<li>define the boxes, their status (in case of an open system, details below) and the layout of the model for diagram rendering<br>
</li>
<li>define initial default box sizes (mass of element X)<br>
</li>
<li>define the values of fluxes between boxes<br>
</li>
<li>define the values of stable isotope fractionation coefficients linked to these fluxes</li>
</ul>
<p>The format of the <em>isobxr master file</em> is standardized. The user is encouraged to comply with these standards, as described thereafter, otherwise there is a high probability for these functions to crash.</p>
<div id="isobxr-master-file-name-and-location" class="section level4">
<h4 class="hasAnchor">
<a href="#isobxr-master-file-name-and-location" class="anchor"></a><strong>isobxr master file</strong> name and location</h4>
<ul>
<li>The <em>isobxr master file</em> is an xlsx file.<br>
</li>
<li>The <em>isobxr master file</em> name needs to be exactly as follows: [ <strong>0_ISOBXR_MASTER.xlsx</strong> ].</li>
<li>the <em>isobxr master file</em> should be stored in the directory in which all runs (single or multiple runs) for this box model system will be performed and where all outputs will be stored in automatically created subdirectories. This directory corresponds to the working directory (<em>workdir</em>) used as parameter of the <code>run_isobxr</code> function.</li>
</ul>
</div>
<div id="isobxr-master-file-structure" class="section level4">
<h4 class="hasAnchor">
<a href="#isobxr-master-file-structure" class="anchor"></a><strong>isobxr master file structure</strong>
</h4>
<p>The <em>isobxr master file</em> contains the 4 following sheet strictly named as follows:</p>
<ol style="list-style-type: decimal">
<li>
<strong>CONSTANTS</strong>: Sheet documenting the constants of the isotopic system</li>
<li>
<strong>BOXES</strong>: Sheet documenting names and status of all boxes constituting the system</li>
<li>
<strong>FLUXES</strong>: Sheet documenting the initial box sizes and massic fluxes of element X between boxes (structured as a column list)</li>
<li>
<strong>COEFFS</strong>: Sheet documenting the isotopic fractionation coefficients between all boxes (structured as a column list)</li>
</ol>
</div>
<div id="constants-sheet" class="section level4">
<h4 class="hasAnchor">
<a href="#constants-sheet" class="anchor"></a><strong>CONSTANTS</strong> sheet</h4>
<p><img src="5_FORMAT_INPUT_CONSTANTS.png" width="75%"></p>
<p>The <strong>CONSTS</strong> sheet should be strictly structured as shown here.</p>
<p>All <em>text in black</em> has to be strictly the same as shown.</p>
<p>All <em>red text</em> corresponds to numerical or litteral variables set by the user:</p>
<ul>
<li>
<strong>X</strong> is the element of interest. Example: Ca</li>
<li>
<strong><span class="math inline">\(R_{std}\)</span></strong> is the isotope ratio of a standard or reference material, used to express the delta value. Example: 3.20297</li>
<li>
<strong>M</strong> is the numerator isotope. Example: 44</li>
<li>
<strong>N</strong> is the denominator isotope. Example: 42</li>
</ul>
<p>These constants will be used throughout all runs performed within the working directory in which the <em>isobxr master file</em> is stored.</p>
</div>
<div id="boxes-sheet" class="section level4">
<h4 class="hasAnchor">
<a href="#boxes-sheet" class="anchor"></a><strong>BOXES</strong> sheet</h4>
<p><img src="6_FORMAT_INPUT_BOXES.png" width="75%"></p>
<p>The <strong>BOXES</strong> sheet should be strictly structured as shown here.</p>
<p>All <em>black text</em> has to be strictly the same as shown.</p>
<p>All <em>blue text</em> of the column <em>BOXES_ID</em> corresponds to litteral names of the <em>n</em> boxes defined by the user.</p>
<ul>
<li>These names must be coherent with all other references to box names (as in <strong>FLUXES</strong> or <strong>COEFFS</strong> sheet).<br>
</li>
<li>All boxes refered to everywhere else (such as <strong>FLUXES</strong> or <strong>COEFFS</strong> sheet or called within a function) must be defined in this list.</li>
<li>Two or more boxes can not have the exact same name.</li>
<li>The user must not use any special characters in the box names [ .!@#$%^&amp;*()_+}{';|:/,?&gt;&lt;}].</li>
<li>The user should avoid the use of numerical values in the box names.</li>
<li><p>The user is advised to chose abbvreviated names (preferabily up to 3 characters, for the sake of clarity in diagrams and plots).</p></li>
<li>Example of lists of box names:
<ul>
<li>OCEAN, MTLE, C_CRUST, O_CRUST, RVR for ocean, mantle, continental crust, oceanic crust and river boxes respectively</li>
<li>DIET, MUSCLE, KDN, BONE, UR for diet, muscle, river, bone and urine boxes respectively</li>
</ul>
</li>
</ul>
<p>All <em>red text</em> corresponds to litteral or numerical variables set by the user:</p>
<ul>
<li>The column <strong>INFINITE</strong> is used to store the <em>status of the box</em> depending on the box model design. The first purpose of this column is to specify to the code whether the model represents an <strong>open</strong> or <strong>closed system</strong>.
<ul>
<li>In the <em>case of an open system</em>, the environment boxes (typically <em>source</em> or <em>sink</em> reservoirs) need to have the <strong>INFINITE</strong> status (strictly spelled in this way).<br>
</li>
<li>For all boxes corresponding to <em>finite boxes</em> that are <em>part of the system</em> being either closed or open, the user is free to set a status name that describes the box category. In this case, the box status name needs to be named following the same spelling rules as for the box names.<br>
Several boxes can have the same status name (<em>e.g.</em>, <strong>INTERFACE</strong> or <strong>DEAD_END</strong> or <strong>FINITE</strong>).</li>
<li>Beyond the determination of the <strong>INFINITE</strong> <em>vs.</em> <strong>FINITE</strong> status of a box used for calculation purposes, this column is used by the <strong>isobxr</strong> functions to set a color code in the automatic box model diagram edition.</li>
</ul>
</li>
<li>The <strong>LAYOUT_X</strong> and <strong>LAYOUT_Y</strong> columns correspond to the user defined layout of the box model diagram.
<ul>
<li>It corresponds to the definition of the coordinates of the boxes to be displayed in the diagram over a matrix format (X: line, Y: column, both being positive real numbers).</li>
<li>It is recommended to separate the boxes horizontally (LAYOUT_X) and vertically (LAYOUT_Y) by at least 2 or 3 units to keep for the sake of diagram clarity.</li>
<li>As specified above, it is recommended to keep box names in rather short abbreviated forms (up to 6 or 7 characters) so they remain legible in the diagram.</li>
</ul>
</li>
</ul>
</div>
<div id="fluxes-sheet-1" class="section level4">
<h4 class="hasAnchor">
<a href="#fluxes-sheet-1" class="anchor"></a><strong>FLUXES</strong> sheet</h4>
<p><img src="7_FORMAT_INPUT_FLUXES.png" width="100%"></p>
<p>All <em>black text</em> has to be strictly the same as shown.<br>
All <em>blue text</em> corresponds to litteral names (string of characters) defined by the user.<br>
All <em>red text</em> corresponds to litteral or numerical variables set by the user.</p>
<p>The <strong>FLUXES</strong> sheet takes two types of input: fluxes and box sizes.</p>
<p>The <strong>FLUXES</strong> sheet allows the user to set as many sets of [fluxes + box sizes] conditions as desired, for the system defined in the <strong>BOXES</strong> sheet.</p>
<p>These sets of [fluxes + box sizes] conditions are called <em>flux lists</em> and are stored in as many columns as desired (columns <strong>flux_list_name_1</strong>, <strong>flux_list_name_2</strong> and so on).</p>
<ul>
<li><p>The name of the <em>flux lists</em> columns are determined by the user and refers to a specific set of [fluxes + box sizes] conditions.<br>
It should avoid spaces and special characters other than underscores.<br>
It can contain a number for the sake of list itemization (e.g., <strong>Fx_1</strong> standing for <em>flux list 1</em>).</p></li>
<li><p>The type of input is determined in the <strong>STATUS</strong> column by using stricly either <strong>FLUX</strong> or <strong>SIZE</strong> levels.</p></li>
<li>A list of flux values is built as follows
<ul>
<li>considering a flux <em>F</em> of element <strong>X</strong> from box <em>i</em> to <em>j</em>:
<ul>
<li>the column <strong>FROM</strong> takes the exact name of the box <span class="math inline">\(i\)</span><br>
</li>
<li>the column <strong>TO</strong> takes the name of the box <span class="math inline">\(j\)</span><br>
</li>
<li>the column <strong>ID</strong> remains undocumented, by leaving <strong>NaN</strong><br>
</li>
<li>the column <strong>STATUS</strong> takes the <strong>FLUX</strong> status<br>
</li>
<li>the column <strong>flux_list_name_1</strong> takes the value of the desired <span class="math inline">\(F_{i \to j}\)</span> flux, as a positive or null real number.<br>
</li>
</ul>
</li>
<li>Within a given list, the user defines as many fluxes as desired (while strictly avoiding duplicate fluxes).<br>
</li>
<li>Not all fluxes between all boxes need to be defined.<br>
</li>
<li>All other fluxes that remain not specified by user here will be automatically set to 0 by <code>run_isobxr</code> (no exchange of element X).</li>
</ul>
</li>
<li>A list of box sizes values is built as follows
<ul>
<li>considering a mass <em>m</em> of element <strong>X</strong> in box <em>i</em>:
<ul>
<li>the column <strong>FROM</strong> remains undocumented, by leaving <strong>NaN</strong><br>
</li>
<li>the column <strong>TO</strong> remains undocumented, by leaving <strong>NaN</strong><br>
</li>
<li>the column <strong>ID</strong> takes the exact name of the box <span class="math inline">\(i\)</span><br>
</li>
<li>the column <strong>STATUS</strong> takes the <strong>SIZE</strong> status<br>
</li>
<li>the column <strong>flux_list_name_1</strong> takes the value of the desired <span class="math inline">\(m_{i}\)</span> box size, as a positive or null real number.<br>
</li>
</ul>
</li>
<li>The user needs to define the size of all boxes.</li>
<li>If the box remains unused (no connected flux), its size can be set at 0.</li>
<li>The user is reponsible for carefully chosing meaningful sizes with respect to the inward and outward fluxes.</li>
<li>In case of a <em>negative balance of fluxes</em> for a given box (<em>i.e.</em>, the box is being emptied),
<ul>
<li>If long enough, it is possible that the run leads to the total emptying of the box.</li>
<li>This is dealt with by the <code>run_isobxr</code> function by overwriting the run duration defined by the user by an updated run duration corresponding to the time required to empty the box with the shortest emptying time.<br>
</li>
<li>In this case, the user is warned by a message in the console during the model run.</li>
</ul>
</li>
</ul>
</li>
<li>The <strong>units</strong> of the fluxes (mass unit per time unit) and sizes (mass unit) need to be homogeneous (same mass unit for both).</li>
<li><p>The <strong>units</strong> of the fluxes (mass unit per time unit) and run duration set in the function (time unit) need to be homogeneous (same time unit for both).</p></li>
</ul>
</div>
<div id="coeffs-sheet-1" class="section level4">
<h4 class="hasAnchor">
<a href="#coeffs-sheet-1" class="anchor"></a><strong>COEFFS</strong> sheet</h4>
<p><img src="8_FORMAT_INPUT_COEFFS.png" width="100%"></p>
<p>All <em>black text</em> has to be strictly the same as shown.<br>
All <em>blue text</em> corresponds to litteral names (string of characters) defined by the user.<br>
All <em>red text</em> corresponds to litteral or numerical variables set by the user.</p>
<p>The <strong>COEFFS</strong> sheet takes one type of input: the values of the isotope fractionation coefficients associated to the fluxes (also referred to as <span class="math inline">\(\alpha_{i \to j}\)</span>).</p>
<p>The <strong>COEFFS</strong> sheet allows the user to set as many sets of [coefficients] conditions as desired, for the system defined in the <strong>BOXES</strong> sheet.</p>
<p>These sets of [coefficients] conditions are called <em>coefficients lists</em> and are stored in as many columns as desired (columns <strong>coeff_list_name_1</strong>, <strong>coeff_list_name_2</strong> and so on).</p>
<ul>
<li><p>The name of the <em>coefficients lists</em> columns are determined by the user and refers to a specific set of [coefficients] conditions.<br>
It should avoid spaces and special characters other than underscores.<br>
It can contain a number for the sake of list itemization (e.g., <strong>a_1</strong> standing for <em>coefficients list 1</em>).</p></li>
<li>A list of coefficients values is built as follows
<ul>
<li>considering an isotope fractionation coefficient from box <em>i</em> to <em>j</em>:
<ul>
<li>the column <strong>FROM</strong> takes the exact name of the box <span class="math inline">\(i\)</span><br>
</li>
<li>the column <strong>TO</strong> takes the name of the box <span class="math inline">\(j\)</span><br>
</li>
<li>the column <strong>flux_list_name_1</strong> takes the value of the desired <span class="math inline">\(\alpha_{i \to j}\)</span> coefficient, a strictly positive real number, usually close to 1.<br>
</li>
</ul>
</li>
<li>Within a given list, the user defines as many fractionation coefficients as desired (while strictly avoiding duplicates).<br>
</li>
<li>Not all fractionation coefficients between all boxes need to be defined.<br>
</li>
<li>All other fractionation coefficients that remain not specified by user here will be automatically set to 1 by <code>run_isobxr</code> (no isotope fractionation).</li>
</ul>
</li>
</ul>
<dl>
<dt><strong>remark</strong></dt>
<dd>An important feature of the flux and coefficients lists, as documented by user in <strong>FLUXES</strong> and <strong>COEFFS</strong> sheet, is that the design of these lists does not require the exhaustive description of all possible combinations of box pairs.<br>
Non described box pairs will have their fractionation coefficient set to 1 (or their flux value set to 0 in the case of the fluxes description).
</dd>
</dl>
</div>
</div>
<div id="using-run_isobxr" class="section level2">
<h2 class="hasAnchor">
<a href="#using-run_isobxr" class="anchor"></a>Using <code>run_isobxr</code>
</h2>
<p>We consider the demonstration <em>isobxr master file</em> (0_ISOBXR_MASTER.xlsx) stored in the working directory. In the demonstration example, the <em>isobxr master file</em> describes an imaginary model. It is designed for the calcium <span class="math inline">\(^{44}Ca/^{42}Ca\)</span> isotope ratios.</p>
<p><img src="10_ABCD_CONSTANTS.png" width="75%"></p>
<p>The <strong>BOXES</strong> sheet describes a total system composed of 4 finite boxes (A, B, C, D). The layout of the boxes in the diagram rendering aims at placing these boxes on the four corners of 10x10 units square.</p>
<p><img src="11_ABCD_BOXES.png" width="50%"></p>
<p>We assume that fluxes are expressed in mg of Ca per day, sizes in mg of Ca and run time units will be days.</p>
<p>The <strong>FLUXES</strong> sheet describes 5 flux lists</p>
<ol style="list-style-type: decimal">
<li>
<em>Fx1_ABC_bal</em> describes a balanced closed system composed of 3 finite boxes A, B and C.<br>
</li>
<li>
<em>Fx2_ABC_unbal</em> describes an unbalanced closed system composed of 3 finite boxes A, B and C.<br>
</li>
<li>
<em>Fx3_ABC_unbal</em> describes an unbalanced closed system composed of 3 finite boxes A, B and C.<br>
</li>
<li>
<em>Fx4_ABCD_bal</em> describes a balanced closed system composed of 4 finite boxes A, B, C and D.<br>
</li>
<li>
<em>Fx5_ABCD_unbal</em> describes an unbalanced closed system composed of 4 finite boxes A, B, C and D.</li>
</ol>
<p>All box sizes are here set at 2000 mg.</p>
<p><img src="12_ABCD_FLUXES.png" width="100%"></p>
<p>The <strong>COEFFS</strong> sheet describes 5 lists of fractionation coefficients:</p>
<ul>
<li>
<em>a0</em> describes no isotope fractionation (all <span class="math inline">\(\alpha_{i \to j}\)</span> being equal to one)<br>
</li>
<li>
<em>a1</em> describes a system with 1 fractionation coefficient being different from 1:<br><span class="math inline">\(\alpha_{A \to B} = 0.999\)</span><br>
</li>
<li>
<em>a2</em> describes a system with 2 fractionation coefficients being different from 1:<br><span class="math inline">\(\alpha_{A \to B} = 0.999\)</span>, <span class="math inline">\(\alpha_{B \to A} = 1.001\)</span><br>
</li>
<li>
<em>a3</em> describes a system with 3 fractionation coefficients being different from 1:<br><span class="math inline">\(\alpha_{A \to B} = 0.999\)</span>, <span class="math inline">\(\alpha_{B \to A} = 1.001\)</span>, <span class="math inline">\(\alpha_{C \to A} = 0.9997\)</span><br>
</li>
<li>
<em>a4</em> describes a system with 1 fractionation coefficient being different from 1:<br><span class="math inline">\(\alpha_{C \to D} = 0.99\)</span>
</li>
</ul>
<dl>
<dt><strong>Note</strong></dt>
<dd>how these lists of coefficients only refer to 4 fractionation coefficients, while the total number of possible box pairs is 16. The <code>run_isobxr</code> function takes into consideration the documented pairs (both for fluxes and fractionation coefficients), and automatically sets the value of undocumented pairs to the default one (0 for fluxes and 1 for fractionation coefficients).
</dd>
</dl>
<p><img src="13_ABCD_COEFFS.png" width="100%"></p>
<div id="balanced-3-boxes-closed-system-model" class="section level3">
<h3 class="hasAnchor">
<a href="#balanced-3-boxes-closed-system-model" class="anchor"></a>Balanced 3-boxes closed system model</h3>
<p>We consider here the case a balanced closed system of 3 finite boxes (flux list <em>Fx1_ABC_bal</em>).<br>
For this run we use the <em>a1</em> fractionation coefficients list.<br>
We will run this model for a total time of 2500 days with a resolution of 1 calculation every 10 days (250 steps).</p>
<div class="sourceCode"><pre class="downlit">
<span class="fu"><a href="../reference/run_isobxr.html">run_isobxr</a></span><span class="op">(</span>workdir <span class="op">=</span> <span class="st">"~/DEMO_ABCD"</span>, <span class="co"># isobxr master file work. dir.</span>
           SERIES_ID <span class="op">=</span> <span class="st">"ABC_balanced_closed"</span>, <span class="co"># series ID of the set of runs</span>
           flux_list_name <span class="op">=</span> <span class="st">"Fx1_ABC_bal"</span>, <span class="co"># which flux list from FLUXES sheet</span>
           coeff_list_name <span class="op">=</span> <span class="st">"a1"</span>, <span class="co"># which coefficients list from COEFFS sheet </span>
           t_lim <span class="op">=</span> <span class="fl">2500</span>, <span class="co"># how long do I want to run</span>
           nb_steps <span class="op">=</span> <span class="fl">250</span>, <span class="co"># how many steps over this run duration</span>
           time_units <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"days"</span>, <span class="st">"years"</span><span class="op">)</span>, <span class="co"># run time units (days), plot time units (years)</span>
           PLOT_evD <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="co"># export plot as pdf </span></pre></div>
<p>The first default outputs of the run are the messages sent by the function on the R console (all of these pieces of information being besides stored in the LOG file).</p>
<p>The <code>run_isobxr</code> function therefore choses to run the analytical solver (<code>ana_slvr</code>).</p>
<p>In the case of this run we can see the following messages:</p>
<pre><code>#&gt; [1] "&lt; All boxes are FINITE &gt;"
#&gt; [1] "&lt; Running ana_slvr (BALANCED FINITE BOXES) &gt; "</code></pre>
<p>This is expected since no INFINITE box has been declared and all inward and outward fluxes for each box are expected to be balanced.</p>
<p>The associated pre-run outputs (optional) are the model diagrams of fluxes (left) and of fractionation coefficients (right, expressed as amplitude of isotope fractionation, in ‰).</p>
<p><img src="15_ABC_balanced_closed_0001_DIAGf_Fx1_ABC_bal.png" width="47%"><img src="14_ABC_balanced_closed_0001_DIAGa_a1.png" width="47%"></p>
<p>Finally, the post-run output includes the evolution of <span class="math inline">\(\delta\)</span> values over the run duration, shown in years for this run.</p>
<p><img src="16_ABC_balanced_closed_0001_plot_evD.png" width="100%"></p>
<p>Note that the run resolution can be seen by the discrete behavior of the evolution of <span class="math inline">\(\delta\)</span> values on the left handside of the logarithmic time scale. This display effect would be smoothed out by a higher run resolution (nb_steps = 2500 or 25000 for instance).</p>
</div>
<div id="unbalanced-3-boxes-closed-system-model" class="section level3">
<h3 class="hasAnchor">
<a href="#unbalanced-3-boxes-closed-system-model" class="anchor"></a>Unbalanced 3-boxes closed system model</h3>
<p>We consider here the case of an unbalanced closed system of 3 finite boxes (flux list <em>Fx2_ABC_unbal</em>).<br>
For this run we use the <em>a1</em> fractionation coefficients list.<br>
We will run this model for a total time of 2500 days with a resolution of 1 calculation every 10 days (250 steps).</p>
<div class="sourceCode"><pre class="downlit">
<span class="fu"><a href="../reference/run_isobxr.html">run_isobxr</a></span><span class="op">(</span>workdir <span class="op">=</span> <span class="st">"~/DEMO_ABCD"</span>, <span class="co"># isobxr master file work. dir.</span>
           SERIES_ID <span class="op">=</span> <span class="st">"ABC_unbalanced_closed"</span>, <span class="co"># series ID of the set of runs</span>
           flux_list_name <span class="op">=</span> <span class="st">"Fx2_ABC_unbal"</span>, <span class="co"># which flux list from FLUXES sheet</span>
           coeff_list_name <span class="op">=</span> <span class="st">"a1"</span>, <span class="co"># which coefficients list from COEFFS sheet </span>
           t_lim <span class="op">=</span> <span class="fl">2500</span>, <span class="co"># how long do I want to run</span>
           nb_steps <span class="op">=</span> <span class="fl">250</span>, <span class="co"># how many steps over this run duration</span>
           time_units <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"days"</span>, <span class="st">"years"</span><span class="op">)</span>, <span class="co"># run time units (days), plot time units (years)</span>
           PLOT_evD <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="co"># export plot as pdf </span></pre></div>
<p>The first default outputs of the run are the messages sent by the function on the R console (all of these pieces of information being besides stored in the LOG file).</p>
<p>In the case of this run we can see the following messages:</p>
<pre><code>#&gt; [1] "&lt; All boxes are FINITE &gt;"
#&gt; [1] "&lt; A IN-OUT BALANCE is pos &gt;"
#&gt; [1] "&lt; C IN-OUT BALANCE is neg (max run: 2000 t units) &gt;"
#&gt; [1] "&lt; Running num_slvr (UNBALANCED FINITE BOXES) &gt;"
#&gt; [1] "*** UPDATED TOTAL RUN TIME *** &lt; Total run time has been changed from 2500 to 2000 (limiting box: C) &gt; "</code></pre>
<p>The first message is expected since no INFINITE box has been declared.</p>
<p>The second and third lines point out the fact that boxes A and C are out of balance: A accumulates calcium while C loses calcium.</p>
<p>The function also tells us that it will take in total 2000 days for the box C to be totally emptied. This is expected since C has a size of 2000 mg and, as can be seen on the flux diagram below, C loses 1 mg of Ca per day.</p>
<p>The <code>run_isobxr</code> function therefore choses to run the numerical solver (<code>num_slvr</code>).</p>
<p>Finally, the <code>run_isobxr</code> function warns the user: it automatically updated the total run time, changing it from 2500 days to 2000 days because the box C would have lost all of its calcium by 2000 days.</p>
<p>The associated pre-run outputs (optional) are the model diagrams of fluxes (left) and of fractionation coefficients (right, expressed as amplitude of isotope fractionation, in ‰).</p>
<p><img src="17_ABC_unbalanced_closed_0001_DIAGf_Fx2_ABC_unbal.png" width="47%"><img src="18_ABC_unbalanced_closed_0001_DIAGa_a1.png" width="47%"></p>
<p>Finally, the post-run output includes the evolution of <span class="math inline">\(\delta\)</span> values over the run duration, shown in years for this run.</p>
<p><img src="19_ABC_unbalanced_closed_0001_plot_evD.png" width="100%"></p>
<p>Note that in this example, the slight imbalance does not affect the overall bevaviour of the system at time scale when compared to the balanced system.</p>
</div>
<div id="formatting-the-forcing-parameters" class="section level3">
<h3 class="hasAnchor">
<a href="#formatting-the-forcing-parameters" class="anchor"></a>Formatting the forcing parameters</h3>
<div id="forcing-initial-box-sizes" class="section level4">
<h4 class="hasAnchor">
<a href="#forcing-initial-box-sizes" class="anchor"></a>Forcing initial box sizes</h4>
<p>By default, the <code>run_isobxr</code> function sets the initial box sizes (mass of element X in each box) at the values found in the flux list specified by user.</p>
<p>It is possible to manually overwrite the initial size of one, several or all boxes for a given run performed by <code>run_isobxr</code>.<br>
It is done by defining a data frame structured as follows.</p>
<div class="sourceCode"><pre class="downlit">
<span class="va">FORCING_SIZE</span> <span class="op">&lt;-</span> 
  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>BOXES_ID <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"BOX_1"</span>, <span class="st">"..."</span>, <span class="st">"BOX_i"</span>, <span class="st">"..."</span><span class="op">)</span>,
             SIZE_INIT <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"updated_size_1"</span>, <span class="st">"..."</span>, <span class="st">"updated_size_i"</span>, <span class="st">"..."</span><span class="op">)</span><span class="op">)</span>

<span class="va">FORCING_SIZE</span>
<span class="co">#&gt;   BOXES_ID      SIZE_INIT</span>
<span class="co">#&gt; 1    BOX_1 updated_size_1</span>
<span class="co">#&gt; 2      ...            ...</span>
<span class="co">#&gt; 3    BOX_i updated_size_i</span>
<span class="co">#&gt; 4      ...            ...</span></pre></div>
<p>For the 3-boxes closed system model (ABC), in order to change the size of box C from 2000 mg of Ca (default as specified in <em>isobxr master file</em> for all flux lists of <strong>FLUXES</strong> sheet) to 3000 mg of Ca, the data frame should be structured as follows:</p>
<div class="sourceCode"><pre class="downlit">
<span class="va">FORCING_SIZE</span> <span class="op">&lt;-</span> 
  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>BOXES_ID <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"C"</span><span class="op">)</span>,
             SIZE_INIT <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">3000</span><span class="op">)</span><span class="op">)</span>

<span class="va">FORCING_SIZE</span>
<span class="co">#&gt;   BOXES_ID SIZE_INIT</span>
<span class="co">#&gt; 1        C      3000</span></pre></div>
</div>
<div id="forcing-initial-delta-values" class="section level4">
<h4 class="hasAnchor">
<a href="#forcing-initial-delta-values" class="anchor"></a>Forcing initial delta values</h4>
<p>By default, the <code>run_isobxr</code> function sets the initial delta values of all boxes at 0 ‰.</p>
<p>It is possible to manually overwrite the initial delta values of one, several or all boxes for a given run performed by <code>run_isobxr</code>.<br>
It is done by defining a data frame structured as follows.</p>
<div class="sourceCode"><pre class="downlit">
<span class="va">FORCING_DELTA</span> <span class="op">&lt;-</span> 
  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>BOXES_ID <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"BOX_1"</span>, <span class="st">"..."</span>, <span class="st">"BOX_i"</span>, <span class="st">"..."</span><span class="op">)</span>,
             DELTA_INIT <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"updated_delta_1"</span>, <span class="st">"..."</span>, <span class="st">"updated_delta_i"</span>, <span class="st">"..."</span><span class="op">)</span><span class="op">)</span>

<span class="va">FORCING_DELTA</span>
<span class="co">#&gt;   BOXES_ID      DELTA_INIT</span>
<span class="co">#&gt; 1    BOX_1 updated_delta_1</span>
<span class="co">#&gt; 2      ...             ...</span>
<span class="co">#&gt; 3    BOX_i updated_delta_i</span>
<span class="co">#&gt; 4      ...             ...</span></pre></div>
<p>For the 3-boxes closed system model (ABC), in order to force the fractionation coefficient associated to the flux of Ca from box A to B to the value of 1.02, the data frame should be structured as follows:</p>
<div class="sourceCode"><pre class="downlit">
<span class="va">FORCING_DELTA</span> <span class="op">&lt;-</span> 
  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>BOXES_ID <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"A"</span><span class="op">)</span>,
             DELTA_INIT <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span>

<span class="va">FORCING_DELTA</span>
<span class="co">#&gt;   BOXES_ID DELTA_INIT</span>
<span class="co">#&gt; 1        A         -1</span></pre></div>
</div>
<div id="forcing-isotope-fractionation-coefficients" class="section level4">
<h4 class="hasAnchor">
<a href="#forcing-isotope-fractionation-coefficients" class="anchor"></a>Forcing isotope fractionation coefficients</h4>
<p>By default, the <code>run_isobxr</code> function sets the isotope fractionation coefficients at the values found in the coefficients list specified by user.</p>
<p>It is possible to manually overwrite the fractionation coefficients of one, several or all pairs of boxes for a given run performed by <code>run_isobxr</code>.<br>
It is done by defining a data frame structured as follows.</p>
<div class="sourceCode"><pre class="downlit">
<span class="va">FORCING_ALPHA</span> <span class="op">&lt;-</span> 
  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>FROM <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"BOX_i"</span>, <span class="st">"..."</span><span class="op">)</span>,
             TO <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"BOX_j"</span>, <span class="st">"..."</span><span class="op">)</span>,
             ALPHA <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"new_coeff_value"</span>, <span class="st">"..."</span><span class="op">)</span>,
             FROM_TO <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"BOX_i_BOX_j"</span>, <span class="st">"..."</span><span class="op">)</span><span class="op">)</span>

<span class="va">FORCING_ALPHA</span>
<span class="co">#&gt;    FROM    TO           ALPHA     FROM_TO</span>
<span class="co">#&gt; 1 BOX_i BOX_j new_coeff_value BOX_i_BOX_j</span>
<span class="co">#&gt; 2   ...   ...             ...         ...</span></pre></div>
<p>For the 3-boxes closed system model (ABC), in order to force the fractionation coefficient associated to the flux of Ca from box A to B to the value of 1.02, the data frame should be structured as follows:</p>
<div class="sourceCode"><pre class="downlit">
<span class="va">FORCING_ALPHA</span> <span class="op">&lt;-</span> 
  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>FROM <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"A"</span><span class="op">)</span>,
             TO <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"B"</span><span class="op">)</span>,
             ALPHA <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1.02</span><span class="op">)</span>,
             FROM_TO <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"A_B"</span><span class="op">)</span><span class="op">)</span>

<span class="va">FORCING_ALPHA</span>
<span class="co">#&gt;   FROM TO ALPHA FROM_TO</span>
<span class="co">#&gt; 1    A  B  1.02     A_B</span></pre></div>
</div>
<div id="forcing-fractionation-coefficient-to-a-rayleigh-distillation-model" class="section level4">
<h4 class="hasAnchor">
<a href="#forcing-fractionation-coefficient-to-a-rayleigh-distillation-model" class="anchor"></a>Forcing fractionation coefficient to a Rayleigh distillation model</h4>
<p>It is possible to overwrite isotope fractionation coefficients by defining their values as the result of Rayleigh type isotope distillation in the context of a fractional exchange at an interface.</p>
<p>We consider here the case of the loss of element X from a box A to a box C through an interface box B, all possibly part of a bigger box model system.</p>
<p>We suppose that the apparent fractionation coefficient <span class="math inline">\(\alpha_{A \to C}\)</span> associated to this flux <span class="math inline">\(F_{A \to C}\)</span> results from a Rayleigh type distillation occuring during the fractional exchange of element X at the interface box B.</p>
<p><img src="20_Rayleigh_distillation_design.png" width="100%"></p>
<p>In this situation, the box A exchanges element X with box B (and possibly other boxes).</p>
<p>This is a fractional exchange, <em>i.e.</em> during this exchange, box A sends more of element X to box B than B sends back (<span class="math inline">\(F_{A \to B} &gt; F_{B \to A}\)</span>).</p>
<p>As we consider box B to be balanced, it loses the difference to box C: <span class="math inline">\(F_{B \to C} = F_{A \to B} - F_{B \to A}\)</span>.</p>
<p>As a result, box A loses a total of <span class="math inline">\(F_{B \to C}\)</span> of element X per time unit.</p>
<p>We suppose here that the <span class="math inline">\(F_{A \to B}\)</span> that feeds box B is associated to no isotope fractionation.</p>
<p>On the other hand, we suppose that the <span class="math inline">\(F_{B \to A}\)</span> flux corresponding to the fractional loss of element X from interface box B, and returning to box A, is associated to an <em>equilibrium</em> or <em>incremental</em> isotope fractionation (<span class="math inline">\(\alpha^0 _{B \to A}\)</span>).</p>
<p>The Rayleigh distillation model of isotopes thus predicts the following:</p>
<p><span class="math display">\[R_{C} = R_{C, t_0} \dfrac{F_{B \to C}}{F_{A \to B}}^{\alpha^0 _{B \to A} - 1}  \]</span></p>
<p>The <span class="math inline">\(R_{C, t_0}\)</span> corresponds to the isotope ratio of the element X in box B before any exchange with box A occurs. It is thus equivalent to <span class="math inline">\(R_{A}\)</span> since the box B only input is <em>via</em> the <span class="math inline">\(F_{A \to B}\)</span> flux.</p>
<p>We thus can write the following definition of <span class="math inline">\(\alpha_{B \to C}\)</span> (equivalent here to <span class="math inline">\(\alpha_{A \to C}\)</span>):</p>
<p><span class="math inline">\(\alpha_{B \to C} = \dfrac{R_{C}}{R_{A}} = \dfrac{F_{B \to C}}{F_{A \to B}}^{\alpha^0 _{B \to A} - 1}\)</span></p>
<p>The <code>run_isobxr</code> function here takes as an optional input the data frame structured as follows:</p>
<div class="sourceCode"><pre class="downlit">
<span class="va">FORCING_RAYLEIGH</span> <span class="op">&lt;-</span> 
  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>XFROM <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"B"</span><span class="op">)</span>, <span class="co"># Define the B&gt;C flux at numerator</span>
             XTO <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"C"</span><span class="op">)</span>,
             YFROM <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"A"</span><span class="op">)</span>, <span class="co"># Define the A&gt;B flux at denominator</span>
             YTO <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"B"</span><span class="op">)</span>,
             AFROM <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"B"</span><span class="op">)</span>, <span class="co"># Define the resulting fractionation coefficient</span>
             ATO <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"C"</span><span class="op">)</span>,
             ALPHA_0 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"a0"</span><span class="op">)</span> <span class="co"># Define the value of incremental B&gt;A coefficient</span>
  <span class="op">)</span> 

<span class="va">FORCING_RAYLEIGH</span>
<span class="co">#&gt;   XFROM XTO YFROM YTO AFROM ATO ALPHA_0</span>
<span class="co">#&gt; 1     B   C     A   B     B   C      a0</span></pre></div>
<p>The <code>run_isobxr</code> function will in this case overwrite the value of <span class="math inline">\(\alpha_{B \to C}\)</span> set in <em>isobxr master file</em> or using the FORCING_ALPHA parameter.</p>
<p>Indeed, if the user forced a new value for <span class="math inline">\(\alpha_{B \to C}\)</span> using the FORCING_ALPHA parameter, the <code>run_isobxr</code> function will prioritize the FORCING_RAYLEIGH parameter.</p>
<p>It is possible to define several Rayleigh distillation apparent fractionation coefficients in a given model.<br>
This is done by adding rows to this data frame.</p>
</div>
</div>
<div id="dealing-with-an-open-system" class="section level3">
<h3 class="hasAnchor">
<a href="#dealing-with-an-open-system" class="anchor"></a>Dealing with an open system</h3>
<p>The user should define a source box and a sink box and declare them in the <strong>BOXES</strong> sheet as INFINITE. We give below an example of a run of for an open system.</p>
<p><img src="21a_ABC_balanced_open_BOXES.png" width="50%"></p>
<p>These boxes should have infinite sizes defined in relation to the system scale (important for runs with unbalanced finite boxes, which will use the numerical solver). In this example, both source and sink box sizes were set at <span class="math inline">\(10^{15}\)</span>.</p>
<p>The source box should only be used with outward fluxes to the open system and should not receive any flux from it.</p>
<p>The sink box should only be used with inward fluxes from the open system and should not send any flux to it.</p>
<p>The function call would be the following for a run of 25000 days, with one calculation every 10 days (nb_steps = 2500).</p>
<p>We use the <em>Fx6_ABC_open_bal</em> flux list and the <em>a1</em> coefficient list.</p>
<div class="sourceCode"><pre class="downlit">
<span class="fu"><a href="../reference/run_isobxr.html">run_isobxr</a></span><span class="op">(</span>workdir <span class="op">=</span> <span class="st">"~/DEMO_ABCD"</span>, <span class="co"># isobxr master file work. dir.</span>
           SERIES_ID <span class="op">=</span> <span class="st">"ABC_balanced_open"</span>, <span class="co"># series ID of the set of runs</span>
           flux_list_name <span class="op">=</span> <span class="st">"Fx6_ABC_open_bal"</span>, <span class="co"># which flux list from FLUXES sheet</span>
           coeff_list_name <span class="op">=</span> <span class="st">"a1"</span>, <span class="co"># which coefficients list from COEFFS sheet </span>
           t_lim <span class="op">=</span> <span class="fl">25000</span>, <span class="co"># how long do I want to run</span>
           nb_steps <span class="op">=</span> <span class="fl">2500</span>, <span class="co"># how many steps over this run duration</span>
           time_units <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"days"</span>, <span class="st">"years"</span><span class="op">)</span>, <span class="co"># run time units (days), plot time units (years)</span>
           PLOT_evD <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="co"># export plot as pdf </span></pre></div>
<p>We obtain the following diagrams, where the infinite boxes display a different color.</p>
<p><img src="22_ABC_balanced_open_0001_DIAGf_Fx6_ABC_open_bal.png" width="47%"><img src="21_ABC_balanced_open_0001_DIAGa_a1.png" width="47%"></p>
<p>And we finally obtain the following plot of the evolution of <span class="math inline">\(\delta\)</span> values in all finite boxes over time, where we observe the relaxation of the system to it's steady state.</p>
<p><img src="23_ABC_balanced_open_0001_plot_evD.png" width="100%"></p>
<p>Note that both infinite boxes are hidden from this graphic representation but the isotope compositions of all boxes - including source and sink - are stored in the output data files.</p>
<p>While the sink (or waste) box is not informative as such, the source could have varying/non-zero initial <span class="math inline">\(\delta\)</span> values, depending on the run parameters, used to force the open system. It will be notably of importance for the use of the <code>compose_isobxr</code> function, described thereafter.</p>
<hr>
</div>
</div>
</div>
<div id="compose-isobxr-scenarios-with-compose_isobxr" class="section level1">
<h1 class="hasAnchor">
<a href="#compose-isobxr-scenarios-with-compose_isobxr" class="anchor"></a>Compose isobxr scenarios with <code>compose_isobxr</code>
</h1>
<div id="how-does-compose_isobxr-work" class="section level2">
<h2 class="hasAnchor">
<a href="#how-does-compose_isobxr-work" class="anchor"></a>How does <code>compose_isobxr</code> work?</h2>
<p>The <code>compose_isobxr</code> function allows to perform a series of successive isobxr runs (calling the <code>run_isobxr</code> function), allowing to build a scenario of composite runs each one inheriting the final state of the previous run as its own initial state.</p>
<p>As defined in the documentation, <code>compose_isobxr</code> takes a series of inputs from a working directory as well as from the user in the console, it stores a track of all the run conditions both in run specific files and in a global LOG file, and it returns several outputs files to an automatically created and managed directory and subdirectories.</p>
<p>To find the detailed description of <code>compose_isobxr</code> inputs and outputs, refer to its documentation:</p>
<div class="sourceCode"><pre class="downlit">
<span class="co"># To see documentation on run_isobxr function, type in console:</span>
<span class="op">?</span><span class="va">compose_isobxr</span></pre></div>
<p>The <code>compose_isobxr</code> general principle is shown in following diagram.</p>
<p><img src="29_compo_structure.png" width="75%"></p>
<p>The basic principle of the <code>compose_isobxr</code> function lies in the fact that it performs a series of successive runs each of them inheriting from the previous runs final conditions as starting conditions.</p>
<p>The simplest use of the <code>compose_isobxr</code> function consists in composing a list of runs with various run duration and resolutions and changing flux lists or coefficients from one run to another.</p>
<p>For instance, it is possible to run a model of balanced system of finite boxes until total relaxation to steady state followed by a run of the same system in a given unbalanced conformation (different flux list) or with a modified set of fractionation coefficients (different coeff list).</p>
<p>Each run will inherit from the previous run final delta values and box sizes and use these as initial values.</p>
<p>It is possible to run the <code>compose_isobxr</code> function with various forcing parameters.</p>
</div>
<div id="format-of-the-compose-master-file" class="section level2">
<h2 class="hasAnchor">
<a href="#format-of-the-compose-master-file" class="anchor"></a>Format of the <em>compose master file</em>
</h2>
<p>In addition to the global <em>isobxr master file</em>, the <code>compose_isobxr</code> function requires a <em>compose master file</em>.</p>
<p>The <em>compose master file</em> is the (xlsx) document containing all commands allowing <code>compose_isobxr</code> function to compose a series of runs and build an isobxr scenario.</p>
<p>It is where the user sets the design of their isobxr scenario:</p>
<ul>
<li>necessary: define the list of <em>m</em> runs composing the scenario (run durations, run resolutions, lists of fluxes, lists of coefficients).<br>
</li>
<li>optional: define the forcings over one or several runs composing the composite scenario (FORCING_RAYLEIGH, FORCING_ALPHA, FORCING_DELTA, FORCING_SIZE).</li>
</ul>
<p>The format of the <em>compose master file</em> is standardized. The user is encouraged to comply with these standards, as described thereafter, otherwise there is a high probability for these functions to crash.</p>
<div id="compose-master-file-name-and-location" class="section level4">
<h4 class="hasAnchor">
<a href="#compose-master-file-name-and-location" class="anchor"></a><strong>compose master file</strong> name and location</h4>
<ul>
<li>The <em>compose master file</em> is an xlsx file.<br>
</li>
<li>The <em>compose master file</em> name is chose by user and specified in the <code>compose_isobxr</code> function inputs: [<em>e.g.</em>, <strong>0_COMPO_MASTER.xlsx</strong> ].<br>
</li>
<li>the <em>compose master file</em> should be stored in the directory in which <em>isobxr master file</em> is found, where all runs for this box model system will be performed and where all outputs will be stored in automatically created subdirectories. This directory corresponds to the working directory (<em>workdir</em>) used as parameter of the <code>compose_isobxr</code> function.</li>
</ul>
</div>
<div id="compose-master-file-structure" class="section level4">
<h4 class="hasAnchor">
<a href="#compose-master-file-structure" class="anchor"></a><strong>compose master file structure</strong>
</h4>
<p>The <em>compose master file</em> contains the 5 following sheet strictly named as follows:</p>
<ol style="list-style-type: decimal">
<li>
<strong>RUN_LIST</strong>: define the list of <em>m</em> runs composing the scenario (run durations, run resolutions, lists of fluxes, lists of coefficients).<br>
</li>
<li>
<strong>FORCING_RAYLEIGH</strong>: define Rayleigh forcings over one or several runs composing the composite scenario.<br>
</li>
<li>
<strong>FORCING_ALPHA</strong>: define Rayleigh forcings over one or several runs composing the composite scenario.<br>
</li>
<li>
<strong>FORCING_DELTA</strong>: define initial delta forcings over one or several runs composing the composite scenario.<br>
</li>
<li>
<strong>FORCING_SIZE</strong>: define initial box size forcings over one or several runs composing the composite scenario.</li>
</ol>
</div>
<div id="run_list-sheet-filling-required" class="section level4">
<h4 class="hasAnchor">
<a href="#run_list-sheet-filling-required" class="anchor"></a><strong>RUN_LIST</strong> sheet (<em>FILLING REQUIRED</em>)</h4>
<p><img src="24_COMPO_RUN_LIST.png" width="100%"></p>
<p>The <code>compose_isobxr</code> function requires a list of successive <em>m</em> runs.</p>
<p>Each of these runs should be succesively described one by one on every row of this sheet, with notably:</p>
<ol style="list-style-type: decimal">
<li>the run number (COMPO_RUN_n column)<br>
</li>
<li>the run duration (t_lim_list column)<br>
</li>
<li>the run resolution (nb_steps_list)<br>
</li>
<li>the flux list name (flux_list) that will be read from <em>isobxr master file</em><br>
</li>
<li>the coefficients list name (coeff_list) that will be read from <em>isobxr master file</em>
</li>
</ol>
<p>One run should not be described twice.</p>
</div>
<div id="forcing_size-sheet-filling-optional" class="section level4">
<h4 class="hasAnchor">
<a href="#forcing_size-sheet-filling-optional" class="anchor"></a><strong>FORCING_SIZE</strong> sheet (<em>FILLING OPTIONAL</em>)</h4>
<p><img src="26_COMPO_FORCING_SIZE.png" width="50%"></p>
<p>It is possible to force the initial size of a given run for one or several boxes.</p>
<p>To do so, you need to specify which run the forcing should apply to (COMPO_RUN_n column)<br>
and the same details as required for the FORCING_SIZE parameter in <code>run_isobxr</code> (see previous section).</p>
<p>It is possible to force the local run initial size of several boxes within a given composite run by filling one line per box, with the same COMPO_RUN_n number.</p>
<p>In case no size forcing is required by the user, this sheet should remain with the table headers as such but with empty lines below.</p>
</div>
<div id="forcing_delta-sheet-filling-optional" class="section level4">
<h4 class="hasAnchor">
<a href="#forcing_delta-sheet-filling-optional" class="anchor"></a><strong>FORCING_DELTA</strong> sheet (<em>FILLING OPTIONAL</em>)</h4>
<p><img src="27_COMPO_FORCING_DELTA.png" width="50%"></p>
<p>It is possible to force the initial delta values of a given run for one or several boxes.</p>
<p>To do so, you need to specify which run the forcing should apply to (COMPO_RUN_n column)<br>
and the same details as required for the FORCING_DELTA parameter in <code>run_isobxr</code> (see previous section).</p>
<p>It is possible to force the local run initial delta of several boxes within a given composite run by filling one line per box, with the same COMPO_RUN_n number.</p>
<p>In case no delta forcing is required by the user, this sheet should remain with the table headers as such but with empty lines below.</p>
</div>
<div id="forcing_alpha-sheet-filling-optional" class="section level4">
<h4 class="hasAnchor">
<a href="#forcing_alpha-sheet-filling-optional" class="anchor"></a><strong>FORCING_ALPHA</strong> sheet (<em>FILLING OPTIONAL</em>)</h4>
<p><img src="28_COMPO_FORCING_ALPHA.png" width="50%"></p>
<p>It is possible to force the fractionation coefficient values of a given run for one or several pairs of boxes.</p>
<p>To do so, you need to specify which run the forcing should apply to (COMPO_RUN_n column)<br>
and the same details as required for the FORCING_ALPHA parameter in <code>run_isobxr</code> (see previous section).</p>
<p>It is possible to force the local run fractionation coefficients of several pairs of boxes within a given composite run by filling one line per pair of boxes, with the same COMPO_RUN_n number.</p>
<p>In case no alpha forcing is required by the user, this sheet should remain with the table headers as such but with empty lines below.</p>
</div>
<div id="forcing_rayleigh-sheet-filling-optional" class="section level4">
<h4 class="hasAnchor">
<a href="#forcing_rayleigh-sheet-filling-optional" class="anchor"></a><strong>FORCING_RAYLEIGH</strong> sheet (<em>FILLING OPTIONAL</em>)</h4>
<p><img src="25_COMPO_FORCING_RAYLEIGH.png" width="100%"></p>
<p>It is possible to force the fractionation coefficient to follow a Rayleigh distillation model in a given run for one or several Rayleigh distillation models.</p>
<p>To do so, you need to specify which run the forcing should apply to (COMPO_RUN_n column)<br>
and the same details as required for the FORCING_RAYLEIGH parameter in <code>run_isobxr</code> (see previous section).</p>
<p>It is possible to force the local run fractionation coefficients of several pairs of boxes within a given composite run by filling one line per pair of boxes, with the same COMPO_RUN_n number.</p>
<p>In case no Rayleigh forcing is required by the user, this sheet should remain with the table headers as such but with empty lines below.</p>
</div>
</div>
<div id="using-compose_isobxr" class="section level2">
<h2 class="hasAnchor">
<a href="#using-compose_isobxr" class="anchor"></a>Using <code>compose_isobxr</code>
</h2>
<div id="example-1-perturbating-the-fluxes" class="section level3">
<h3 class="hasAnchor">
<a href="#example-1-perturbating-the-fluxes" class="anchor"></a>example #1: perturbating the fluxes</h3>
<p>We compose here the first scenario as described on the screenshot of the <em>composite master file</em> used for this run.</p>
<p><img src="30_RUN_LIST_ABC.png" width="75%"></p>
<p>Here, we start with the previous example: a set of 3 finite boxes (A, B, C) consituting an open system interacting with the environment (SOURCE and SINK boxes).</p>
<ol style="list-style-type: decimal">
<li>We first let the system relax to its' steady-state in a balanced configuration using the <em>Fx6_ABC_open_bal</em> flux list for a total of 25000 days (70 years).<br>
</li>
<li>We then let the system run with the exact same conditions for 100 days.<br>
</li>
<li>We then provoke a disequilibrium by using an unbalanced <em>Fx7_ABC_open_unbal</em> flux list (A loses 10 mg of Ca per day, B accumulates 10 mg of Ca per day).<br>
</li>
<li>We then let the system relax again with the previous balanced flux configuration (<em>Fx6_ABC_open_bal</em>) but with automatically inherited different initial conditions of delta and size values.</li>
</ol>
<p>We call the function as follows:</p>
<div class="sourceCode"><pre class="downlit">
<span class="va">workdir</span> <span class="op">&lt;-</span> <span class="st">"~/DEMO_ABCD"</span> <span class="co"># isobxr and compo master file work. dir.</span>
<span class="va">SERIES_ID</span> <span class="op">&lt;-</span> <span class="st">"ABC_change_balance"</span> <span class="co"># series ID of the set of compo runs</span>
<span class="va">time_units</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"days"</span>, <span class="st">"days"</span><span class="op">)</span> <span class="co"># time units for run (days) and for plots (years)</span>
<span class="va">COMPO_MASTER</span> <span class="op">&lt;-</span> <span class="st">"0_COMPO_MASTER_balance_change.xlsx"</span> <span class="co"># compo master file name</span>
<span class="va">plot_HIDE_BOXES_delta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"SINK"</span><span class="op">)</span> <span class="co"># boxes to hide from evD plot</span>
<span class="va">plot_HIDE_BOXES_size</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"SOURCE"</span>, <span class="st">"SINK"</span><span class="op">)</span> <span class="co"># boxes to hide from evS plot</span>
  
<span class="fu"><a href="../reference/compose_isobxr.html">compose_isobxr</a></span><span class="op">(</span><span class="va">workdir</span>,
               <span class="va">SERIES_ID</span>, 
               <span class="va">time_units</span>,
               <span class="va">COMPO_MASTER</span>, 
               <span class="va">plot_HIDE_BOXES_delta</span>, 
               <span class="va">plot_HIDE_BOXES_size</span><span class="op">)</span></pre></div>
<p>We obtain the following overviews of the evolution of delta values and box sizes over the run duration. By default the plotting functionnality of the <code>compose_isobxr</code> function hides initial run of the composite scenario because it is usually used as a run to let the system artificially relax to it's steady state.<br>
Nevertheless, all the data files edited by the function do include the initial run of the composite scenario.</p>
<p>Below is the plot evDS output of both delta and box sizes over time. <img src="31_CPS_ABC_change_balance_001_p_evDS.png" width="100%"></p>
<p>Below is the facetted plot evD output of delta values in each box over time. <img src="32_CPS_ABC_change_balance_001_pf_evD.png" width="100%"></p>
<p>Below is the facetted plot evS output of box sizes in each box over time. <img src="33_CPS_ABC_change_balance_001_pf_evS.png" width="100%"></p>
</div>
<div id="example-2-changing-the-source-isotope-composition" class="section level3">
<h3 class="hasAnchor">
<a href="#example-2-changing-the-source-isotope-composition" class="anchor"></a>example #2: changing the source isotope composition</h3>
<p>We consider here the same model example of 3 balanced finite boxes in an open system.</p>
<p>In this case, we leave the same balanced flux configuration for the whole duration of the scenario. We also leave the run durations and resolutions unchanged.</p>
<p><img src="35_FORCING_DELTA_ABC_RUN_LIST.png" width="75%"></p>
<p>We however force the delta values of the source box as shown below:</p>
<p><img src="34_FORCING_DELTA_ABC.png" width="50%"></p>
<ol style="list-style-type: decimal">
<li>At runs 1 and 2, we leave the source default delta value (0‰).</li>
<li>At run 3, we change the source default delta value from 0 to + 0.5 ‰.</li>
<li>At run 4, we change the source delta value bcak to 0‰.</li>
</ol>
<p>We call the function as follows:</p>
<div class="sourceCode"><pre class="downlit">
<span class="va">workdir</span> <span class="op">&lt;-</span> <span class="st">"~/DEMO_ABCD"</span> <span class="co"># isobxr and compo master file work. dir.</span>
<span class="va">SERIES_ID</span> <span class="op">&lt;-</span> <span class="st">"ABC_change_source"</span> <span class="co"># series ID of the set of compo runs</span>
<span class="va">time_units</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"days"</span>, <span class="st">"days"</span><span class="op">)</span> <span class="co"># time units for run (days) and for plots (years)</span>
<span class="va">COMPO_MASTER</span> <span class="op">&lt;-</span> <span class="st">"0_COMPO_MASTER_source_change.xlsx"</span> <span class="co"># compo master file name</span>
<span class="va">plot_HIDE_BOXES_delta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"SINK"</span><span class="op">)</span> <span class="co"># boxes to hide from evD plot</span>
<span class="va">plot_HIDE_BOXES_size</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"SOURCE"</span>, <span class="st">"SINK"</span><span class="op">)</span> <span class="co"># boxes to hide from evS plot</span>
  
<span class="fu"><a href="../reference/compose_isobxr.html">compose_isobxr</a></span><span class="op">(</span><span class="va">workdir</span>,
               <span class="va">SERIES_ID</span>, 
               <span class="va">time_units</span>,
               <span class="va">COMPO_MASTER</span>, 
               <span class="va">plot_HIDE_BOXES_delta</span>, 
               <span class="va">plot_HIDE_BOXES_size</span><span class="op">)</span></pre></div>
<p>And for instance, we obtain the following evDS pdf output where we see that the effect of the change in the source isotope composition slightly affects the delta values of A, B and C boxes.</p>
<p><img src="36_0_CPS_ABC_change_source_001_p_evDS.png" width="100%"></p>
<hr>
</div>
</div>
</div>
<div id="d-sweep-final-state-with-sweep_steady" class="section level1">
<h1 class="hasAnchor">
<a href="#d-sweep-final-state-with-sweep_steady" class="anchor"></a>2D sweep final state with <code>sweep_steady</code>
</h1>
<div id="how-does-sweep_steady-work" class="section level2">
<h2 class="hasAnchor">
<a href="#how-does-sweep_steady-work" class="anchor"></a>How does <code>sweep_steady</code> work?</h2>
<p>The <code>sweep_steady</code> function is designed to allow the user to map the combined effects of two parameters over the final state of an <strong>isobxr</strong> box model.</p>
<p>It's structure is shown below:</p>
<p><img src="37_Sweep_steady_structure.png" width="75%"></p>
<p>The <code>sweep_steady</code> function is built as a 2 steps composite scenario.</p>
<ol style="list-style-type: decimal">
<li><p>The first run (run #1) is used to force the initial conditions of the second run. It is run once only.</p></li>
<li>The second run (run #2) is repeated for all the combinations of the two parameters values.
<ul>
<li>Each parameter varies over a range of values defined by the user:
<ul>
<li>parameter #1 is ranging over <em>n</em> values, parameter #2 over <em>m</em> values.<br>
</li>
</ul>
</li>
<li>Run #2 is repeated over the whole 2D space of parameters (<span class="math inline">\(n \times m\)</span> times).</li>
</ul>
</li>
</ol>
<p>The main purpose of this <code>sweep_steady</code> structure is:</p>
<ul>
<li>to explore the influence of a pair of parameters over the distribution of isotopes in the system at the final state of run #2<br>
</li>
<li>while starting this run #2 from a common initial state, defined by run #1<br>
</li>
<li>run #1 typically being for a balanced system, relaxed to it's steady state</li>
</ul>
</div>
<div id="format-of-the-sweep-steady-master-file" class="section level2">
<h2 class="hasAnchor">
<a href="#format-of-the-sweep-steady-master-file" class="anchor"></a>Format of the <em>sweep steady master file</em>
</h2>
<p>In addition to the global <em>isobxr master file</em>, the <code>sweep_steady</code> function requires a <em>sweep steady master file</em>.</p>
<p>The <em>sweep steady master file</em> is the (xlsx) document containing all commands allowing <code>sweep_steady</code> function to compose a scenario of 2 runs.</p>
<p>The two parameters to be sweeped over run #2 are defined by user directly in the function input, in the R console.</p>
<p>The format of the <em>sweep steady master file</em> is the same as the <em>compose master file</em> and the <em>sweep dynamic master file</em>.</p>
<p>It is where the user sets the design of their 2 runs scenario to be sweeped:</p>
<ul>
<li>necessary: define the list of 2 runs composing the scenario (run durations, run resolutions, lists of fluxes, lists of coefficients).<br>
</li>
<li>optional: define the forcings over one or both runs composing the composite scenario (FORCING_RAYLEIGH, FORCING_ALPHA, FORCING_DELTA, FORCING_SIZE).</li>
</ul>
<p>The format of the <em>sweep steady master file</em> is standardized. The user is encouraged to comply with these standards, as described thereafter, otherwise there is a high probability for these functions to crash.</p>
<div id="sweep-steady-master-file-name-and-location" class="section level4">
<h4 class="hasAnchor">
<a href="#sweep-steady-master-file-name-and-location" class="anchor"></a><strong>sweep steady master file</strong> name and location</h4>
<ul>
<li>The <em>sweep steady master file</em> is an xlsx file.<br>
</li>
<li>The <em>sweep steady master file</em> name is chosen by user and specified in the <code>sweep_steady</code> function inputs: [<em>e.g.</em>, <strong>0_SWEEP_STEADY_MASTER.xlsx</strong> ].<br>
</li>
<li>the <em>sweep steady master file</em> should be stored in the directory in which <em>isobxr master file</em> is found, where all runs for this box model system will be performed and where all outputs will be stored in automatically created subdirectories. This directory corresponds to the working directory (<em>workdir</em>) used as parameter of the <code>sweep_steady</code> function.</li>
</ul>
</div>
<div id="sweep-steady-master-file-structure" class="section level4">
<h4 class="hasAnchor">
<a href="#sweep-steady-master-file-structure" class="anchor"></a><strong>sweep steady master file structure</strong>
</h4>
<p>The <em>sweep steady master file</em> contains the 5 following sheet strictly named as follows:</p>
<ol style="list-style-type: decimal">
<li>
<strong>RUN_LIST</strong>: define the list of 2 runs composing the sweep steady scenario (run durations, run resolutions, lists of fluxes, lists of coefficients).<br>
</li>
<li>
<strong>FORCING_RAYLEIGH</strong>: define Rayleigh forcings over one or several runs composing the sweep 2 steps scenario.<br>
</li>
<li>
<strong>FORCING_ALPHA</strong>: define Rayleigh forcings over one or several runs composing the sweep 2 steps scenario.<br>
</li>
<li>
<strong>FORCING_DELTA</strong>: define initial delta forcings over one or several runs composing the sweep 2 steps scenario.<br>
</li>
<li>
<strong>FORCING_SIZE</strong>: define initial box size forcings over one or several runs composing the sweep 2 steps scenario.</li>
</ol>
</div>
<div id="run_list-sheet-filling-required-1" class="section level4">
<h4 class="hasAnchor">
<a href="#run_list-sheet-filling-required-1" class="anchor"></a><strong>RUN_LIST</strong> sheet (<em>FILLING REQUIRED</em>)</h4>
<p><img src="37_SW_STD_RUN_LIST.png" width="75%"></p>
<p>The <code>sweep_steady</code> function strictly requires a list of <em>2</em> successive runs.</p>
<p>Both of these runs should be succesively described one by one on two rows of this sheet, with notably:</p>
<ol style="list-style-type: decimal">
<li>the run number (COMPO_RUN_n column)<br>
</li>
<li>the run duration (t_lim_list column)<br>
</li>
<li>the run resolution (nb_steps_list)<br>
</li>
<li>the flux list name (flux_list) that will be read from <em>isobxr master file</em><br>
</li>
<li>the coefficients list name (coeff_list) that will be read from <em>isobxr master file</em>
</li>
</ol>
</div>
<div id="forcing_size-sheet-filling-optional-1" class="section level4">
<h4 class="hasAnchor">
<a href="#forcing_size-sheet-filling-optional-1" class="anchor"></a><strong>FORCING_SIZE</strong> sheet (<em>FILLING OPTIONAL</em>)</h4>
<p><img src="37_SW_STD_FORCING_SIZE.png" width="50%"></p>
<p>See <em>composite master file</em> format description for details.</p>
</div>
<div id="forcing_delta-sheet-filling-optional-1" class="section level4">
<h4 class="hasAnchor">
<a href="#forcing_delta-sheet-filling-optional-1" class="anchor"></a><strong>FORCING_DELTA</strong> sheet (<em>FILLING OPTIONAL</em>)</h4>
<p><img src="37_SW_STD_FORCING_DELTA.png" width="50%"></p>
<p>See <em>composite master file</em> format description for details.</p>
</div>
<div id="forcing_alpha-sheet-filling-optional-1" class="section level4">
<h4 class="hasAnchor">
<a href="#forcing_alpha-sheet-filling-optional-1" class="anchor"></a><strong>FORCING_ALPHA</strong> sheet (<em>FILLING OPTIONAL</em>)</h4>
<p><img src="37_SW_STD_ALPHA.png" width="50%"></p>
<p>See <em>composite master file</em> format description for details.</p>
</div>
<div id="forcing_rayleigh-sheet-filling-optional-1" class="section level4">
<h4 class="hasAnchor">
<a href="#forcing_rayleigh-sheet-filling-optional-1" class="anchor"></a><strong>FORCING_RAYLEIGH</strong> sheet (<em>FILLING OPTIONAL</em>)</h4>
<p><img src="37_SW_STD_FORCING_RAYLEIGH.png" width="75%"></p>
<p>See <em>composite master file</em> format description for details.</p>
</div>
</div>
<div id="using-sweep_steady" class="section level2">
<h2 class="hasAnchor">
<a href="#using-sweep_steady" class="anchor"></a>Using <code>sweep_steady</code>
</h2>
<div id="preparing-the-sweep-steady-master-file" class="section level3">
<h3 class="hasAnchor">
<a href="#preparing-the-sweep-steady-master-file" class="anchor"></a>Preparing the <em>sweep steady master</em> file</h3>
<p>The user needs to define the two runs composing the 2 steps scenario.</p>
<ol style="list-style-type: decimal">
<li>The first run is used to let the system relax to its steady state used as an initial state in run #2.
<ol style="list-style-type: lower-roman">
<li>The user should consider here a balanced system. The <strong>isobxr</strong> functions will thus use the analytical solver (<code>ana_slvr</code>).</li>
<li>We thus recommand the user to set the number of steps for run #1 (nb_steps) to 1 (its' minimum value).<br>
This allows to only calculate the final state of the system, at the end of run #1.<br>
This reduces the calculation time and data produced without affecting the accuracy of the calculation.</li>
</ol>
</li>
<li>The second run is used to explore the final state of the system as a function of all combinations of parameters #1 and #2 values.
<ol style="list-style-type: lower-roman">
<li>The main purpose of this function is to explore the influence of the 2 combined parameters over the final state of a system that relaxed to it's steady state.</li>
<li>It is therefore recommended to use the same balanced system over the second run, allowing to analytically solve the system (with <code>ana_slvr</code>).</li>
<li>The use of the analytical solver will notably allow to map the final state at a high resolution of parameters #1 and #2<br>
while minimizing the required calculation time as well as RAM and hard memory.<br>
</li>
<li>We thus recommand the user to set the number of steps for run #2 (nb_steps) to 1 (its' minimum value).<br>
This allows to only calculate the final state of the system, at the end of run #2.<br>
This reduces the calculation time and data produced without affecting the accuracy of the calculation.</li>
</ol>
</li>
</ol>
<dl>
<dt><strong>remark</strong></dt>
<dd>The reason why the <code>sweep_steady</code> function begins with a run #1 which final state defines a common initial state for all repeated run #2 sweeps is that it can allow the user to sweep the final state of a system in the course transient/dynamic state of run #2, being in a balanced or unbalanced system. This needs however to be designed with care as depending on the defined or forced parameters on run #2 vs. run #1, the continuity of the conditions of run #1 and run #2 is not certain. It is then advised to use the better suited <code>sweep_dyn</code> function described thereafter.
</dd>
<dt><strong>Forcings</strong></dt>
<dd>The user can define some forcings over the system (will affect both run #1 and run #2).<br>
These forcings will overwrite the conditions set by the reading of the <em>isobxr master file</em>.<br>
These forcings will be overwritten by the sweeped parameters that affect run #2.
</dd>
</dl>
</div>
<div id="sweep_steady-console-defined-sweep-parameters" class="section level3">
<h3 class="hasAnchor">
<a href="#sweep_steady-console-defined-sweep-parameters" class="anchor"></a><code>sweep_steady</code> console defined sweep parameters</h3>
<p>In addition to all the usual input parameters required for the <code>sweep_steady</code> function, the user has to define the two parameters to be sweeped.</p>
<p>There are 6 types of sweepable parameters (or that can be explored), which names are strictly defined as follows:</p>
<pre><code>#&gt; [1] "EXPLO_n_FLUX_MATRICES"
#&gt; [1] "EXPLO_n_ALPHA_MATRICES"
#&gt; [1] "EXPLO_1_SIZE"
#&gt; [1] "EXPLO_1_DELTA"
#&gt; [1] "EXPLO_1_ALPHA"
#&gt; [1] "EXPLO_1_RAYLEIGH_ALPHA"</code></pre>
<div id="explo_n_flux_matrices" class="section level4">
<h4 class="hasAnchor">
<a href="#explo_n_flux_matrices" class="anchor"></a><strong>EXPLO_n_FLUX_MATRICES</strong>:</h4>
<p>This type of parameter allows to explore a series of flux lists as defined in <em>isobxr master file</em>.</p>
<div class="sourceCode"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>VALUES <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"flux_list_1"</span>,  <span class="co"># vector of n strings of characters</span>
                      <span class="st">"..."</span>, 
                      <span class="st">"flux_list_i"</span>, 
                      <span class="st">"..."</span>, 
                      <span class="st">"flux_list_n"</span><span class="op">)</span>,  
           EXPLO_TYPES <span class="op">=</span> <span class="st">"EXPLO_n_FLUX_MATRICES"</span><span class="op">)</span> <span class="co"># stricly leave as such</span></pre></div>
<p>The <strong>EXPLO_n_FLUX_MATRICES</strong> parameter will allow the <code>sweep_steady</code> function to sweep the effect of a series of flux lists (defining flux matrices and initial box sizes) on run #2 evolution.</p>
<p>The format of this data frame should be exactly as shown above.</p>
<p>The values are a vector of strings of characters containing the list of flux list names, that will be called from the <em>isobxr master file</em></p>
</div>
<div id="explo_n_alpha_matrices" class="section level4">
<h4 class="hasAnchor">
<a href="#explo_n_alpha_matrices" class="anchor"></a><strong>EXPLO_n_ALPHA_MATRICES</strong>:</h4>
<p>This type of parameter allows to explore a series of lists of coefficients as defined in <em>isobxr master file</em>.</p>
<div class="sourceCode"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>VALUES <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"coeff_list_1"</span>, <span class="co"># vector of n strings of characters</span>
                      <span class="st">"..."</span>, 
                      <span class="st">"coeff_list_i"</span>, 
                      <span class="st">"..."</span>, 
                      <span class="st">"coeff_list_n"</span><span class="op">)</span>, 
           EXPLO_TYPES <span class="op">=</span> <span class="st">"EXPLO_n_ALPHA_MATRICES"</span><span class="op">)</span> <span class="co"># stricly leave as such</span></pre></div>
<p>The <strong>EXPLO_n_ALPHA_MATRICES</strong> parameter will allow the <code>sweep_steady</code> function to sweep the effect of a series of isotope fractionation coefficient lists (defining coefficient matrices) on run #2 evolution.</p>
<p>The format of this data frame should be exactly as shown above.</p>
<p>The values are a vector of strings of characters containing the list of coefficients list names, that will be called from the <em>isobxr master file</em></p>
</div>
<div id="explo_1_size" class="section level4">
<h4 class="hasAnchor">
<a href="#explo_1_size" class="anchor"></a><strong>EXPLO_1_SIZE</strong>:</h4>
<p>This type of parameter allows to explore a range of sizes for a given box.</p>
<div class="sourceCode"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>BOXES_ID <span class="op">=</span> <span class="st">"BOX_i"</span>, <span class="co"># 1 string of char</span>
           SIZE_MIN <span class="op">=</span> <span class="st">"min_sweep_value"</span>, <span class="co"># 1 numerical value</span>
           SIZE_MAX <span class="op">=</span> <span class="st">"max_sweep_value"</span>, <span class="co"># 1 numerical value</span>
           SIZE_STEPS <span class="op">=</span> <span class="st">"sweep_steps"</span>, <span class="co"># 1 numerical value</span>
           EXPLO_TYPES <span class="op">=</span> <span class="st">"EXPLO_1_SIZE"</span><span class="op">)</span> <span class="co"># stricly leave as such</span></pre></div>
<p>The <strong>EXPLO_1_SIZE</strong> parameter will allow the <code>sweep_steady</code> function to sweep the effect of a range of box sizes for a given box on run #2 evolution.</p>
<p>The format of this data frame should be exactly as shown above.</p>
</div>
<div id="explo_1_delta" class="section level4">
<h4 class="hasAnchor">
<a href="#explo_1_delta" class="anchor"></a><strong>EXPLO_1_DELTA</strong>:</h4>
<p>This type of parameter allows to explore a range of delta values for a given box.</p>
<div class="sourceCode"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>BOXES_ID <span class="op">=</span> <span class="st">"BOX_i"</span>, <span class="co"># 1 string of char</span>
           DELTA_MIN <span class="op">=</span> <span class="st">"min_sweep_value"</span>, <span class="co"># 1 numerical value</span>
           DELTA_MAX <span class="op">=</span> <span class="st">"max_sweep_value"</span>, <span class="co"># 1 numerical value</span>
           DELTA_STEPS <span class="op">=</span> <span class="st">"sweep_steps"</span>, <span class="co"># 1 numerical value</span>
           EXPLO_TYPES <span class="op">=</span> <span class="st">"EXPLO_1_DELTA"</span><span class="op">)</span> <span class="co"># stricly leave as such</span></pre></div>
</div>
<div id="explo_1_alpha" class="section level4">
<h4 class="hasAnchor">
<a href="#explo_1_alpha" class="anchor"></a><strong>EXPLO_1_ALPHA</strong>:</h4>
<p>This type of parameter allows to explore a range of alpha (coeff) values for a given flux.</p>
<div class="sourceCode"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>FROM <span class="op">=</span> <span class="st">"BOX_i"</span>, <span class="co"># 1 string of char</span>
           TO <span class="op">=</span> <span class="st">"BOX_j"</span>, <span class="co"># 1 string of char</span>
           ALPHA_MIN <span class="op">=</span> <span class="st">"min_sweep_value"</span>, <span class="co"># 1 numerical value</span>
           ALPHA_MAX <span class="op">=</span> <span class="st">"max_sweep_value"</span>, <span class="co"># 1 numerical value</span>
           ALPHA_STEPS <span class="op">=</span> <span class="st">"sweep_steps"</span>, <span class="co"># 1 numerical value</span>
           EXPLO_TYPES <span class="op">=</span> <span class="st">"EXPLO_1_ALPHA"</span><span class="op">)</span> <span class="co"># stricly leave as such</span></pre></div>
</div>
<div id="explo_1_rayleigh_alpha" class="section level4">
<h4 class="hasAnchor">
<a href="#explo_1_rayleigh_alpha" class="anchor"></a><strong>EXPLO_1_RAYLEIGH_ALPHA</strong>:</h4>
<p>This type of parameter allows to explore a range of incremental alpha values for a Rayleigh distillation model.</p>
<div class="sourceCode"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>XFROM <span class="op">=</span> <span class="st">"Box_B"</span>, <span class="co"># B&gt;C flux at numerator (strings of char)</span>
           XTO <span class="op">=</span> <span class="st">"Box_C"</span>,
           YFROM <span class="op">=</span> <span class="st">"Box_A"</span>, <span class="co"># A&gt;B flux at denominator (strings of char)</span>
           YTO <span class="op">=</span> <span class="st">"Box_B"</span>,
           AFROM <span class="op">=</span> <span class="st">"Box_B"</span>, <span class="co"># resulting fract. coefficient (strings of char)</span>
           ATO <span class="op">=</span> <span class="st">"Box_C"</span>,
           ALPHA_0_MIN <span class="op">=</span> <span class="st">"min_sweep_value"</span>, <span class="co"># value of incremental B&gt;A coeff. (num.)</span>
           ALPHA_0_MAX <span class="op">=</span> <span class="st">"max_sweep_value"</span>, 
           ALPHA_0_STEPS <span class="op">=</span> <span class="st">"sweep_steps"</span>,
           EXPLO_TYPES <span class="op">=</span> <span class="st">"EXPLO_1_RAYLEIGH_ALPHA"</span><span class="op">)</span> <span class="co"># stricly leave as such</span></pre></div>
<hr>
</div>
</div>
<div id="example-sweeping-two-fractionation-coefficients-in-a-3-boxes-balanced-open-system" class="section level3">
<h3 class="hasAnchor">
<a href="#example-sweeping-two-fractionation-coefficients-in-a-3-boxes-balanced-open-system" class="anchor"></a>Example: sweeping two fractionation coefficients in a 3-boxes balanced open system</h3>
<p>Here:</p>
<ul>
<li>using the <em>sweep steady master file</em> provided for demonstration (0_EXPLO_STEADY_MASTER_demo1.xlsx)</li>
<li>we perform a sweep of the <span class="math inline">\(\alpha _{C \to B}\)</span> values and <span class="math inline">\(\alpha _{A \to C}\)</span> values at steady state of run #2<br>
</li>
<li>starting from a run #1 at steady state obtained by the relaxation of the system with the <em>a1</em> coefficients list and the <em>Fx6_ABC_open_bal</em> flux list</li>
</ul>
<p>No forcings are applied.</p>
<p>To do so, the <code>sweep_steady</code> function can be used as follows:</p>
<div class="sourceCode"><pre class="downlit">
<span class="va">workdir</span> <span class="op">&lt;-</span> <span class="st">"~/DEMO_ABCD"</span> <span class="co"># isobxr and compo master file work. dir.</span>
<span class="va">SERIES_ID</span> <span class="op">&lt;-</span> <span class="st">"ABC_sweep_steady_demo1"</span> <span class="co"># series ID of the set of compo runs</span>
<span class="va">time_units</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"days"</span>, <span class="st">"days"</span><span class="op">)</span> <span class="co"># time units for run (days) and for plots (years)</span>
<span class="va">EXPLO_MASTER</span> <span class="op">&lt;-</span> <span class="st">"0_EXPLO_STEADY_MASTER_demo1.xlsx"</span> <span class="co"># compo master file name</span>

<span class="va">EXPLO_AXIS_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>FROM <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"C"</span><span class="op">)</span>, 
                           TO <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"B"</span><span class="op">)</span>, 
                           ALPHA_MIN <span class="op">=</span> <span class="fl">1</span>, 
                           ALPHA_MAX <span class="op">=</span> <span class="fl">1.0005</span>, 
                           ALPHA_STEPS <span class="op">=</span> <span class="fl">0.00005</span>, 
                           EXPLO_TYPES <span class="op">=</span> <span class="st">"EXPLO_1_ALPHA"</span><span class="op">)</span>

<span class="va">EXPLO_AXIS_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>FROM <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"A"</span><span class="op">)</span>, 
                           TO <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"C"</span><span class="op">)</span>, 
                           ALPHA_MIN <span class="op">=</span> <span class="fl">0.9996</span>, 
                           ALPHA_MAX <span class="op">=</span> <span class="fl">1</span>, 
                           ALPHA_STEPS <span class="op">=</span> <span class="fl">0.00005</span>, 
                           EXPLO_TYPES <span class="op">=</span> <span class="st">"EXPLO_1_ALPHA"</span><span class="op">)</span>

<span class="fu"><a href="../reference/sweep_steady.html">sweep_steady</a></span><span class="op">(</span><span class="va">workdir</span>,
             <span class="va">SERIES_ID</span>,
             <span class="va">time_units</span>,
             <span class="va">EXPLO_MASTER</span>,
             <span class="va">EXPLO_AXIS_1</span>, 
             <span class="va">EXPLO_AXIS_2</span><span class="op">)</span></pre></div>
<p>You can explore the outputs by then using the <strong>isobxr</strong> Shiny app (<code>runShinyPlots</code> function, presented below).</p>
<hr>
</div>
</div>
</div>
<div id="d-sweep-dynamic-response-with-sweep_dyn" class="section level1">
<h1 class="hasAnchor">
<a href="#d-sweep-dynamic-response-with-sweep_dyn" class="anchor"></a>2D sweep dynamic response with <code>sweep_dyn</code>
</h1>
<div id="how-does-sweep_dyn-work" class="section level2">
<h2 class="hasAnchor">
<a href="#how-does-sweep_dyn-work" class="anchor"></a>How does <code>sweep_dyn</code> work?</h2>
<p>The <code>sweep_dyn</code> function is designed to allow the user to map the combined effects of two parameters over the dynamic response of an <strong>isobxr</strong> box model, typically in a system at steady state suddenly facing a perturbation.</p>
<p>It's structure is shown below:</p>
<p><img src="38_Sweep_dyn_structure.png" width="75%"></p>
<p>The <code>sweep_dyn</code> function is built as a 2 steps composite scenario.</p>
<ol style="list-style-type: decimal">
<li>The first run (run #1) is used to force the initial conditions of the second run. It is run repeatedly together with run #2 over the whole space of parameters defined by user.</li>
<li>The second run (run #2) takes system final state of the run #2 as initial state. It is run repeatedly together with run #1 over the whole space of parameters defined by user.</li>
<li>Both runs (#1 and #2) are repeated together for all the combinations of the two parameters values.
<ul>
<li>Each parameter varies over a range of values defined by the user:
<ul>
<li>parameter #1 is ranging over <em>n</em> values, parameter #2 over <em>m</em> values.<br>
</li>
</ul>
</li>
<li>Run #1 and #2 are repeated over the whole 2D space of parameters (<span class="math inline">\(n \times m\)</span> times).</li>
</ul>
</li>
</ol>
<p>The main purpose of this <code>sweep_dyn</code> structure is:</p>
<ul>
<li>to explore the influence of a pair of parameters over the dynamic evolution during run #2 of isotope compositions (and box sizes) in all boxes,</li>
<li>while starting this run #2 from a an initial state defined by run #1 that also depends on the sweeped parameters</li>
<li>run #1 typically being for a balanced system, relaxed to it's steady state</li>
</ul>
</div>
<div id="format-of-the-sweep-dyn-master-file" class="section level2">
<h2 class="hasAnchor">
<a href="#format-of-the-sweep-dyn-master-file" class="anchor"></a>Format of the <em>sweep dyn master file</em>
</h2>
<p>In addition to the global <em>isobxr master file</em>, the <code>sweep_dyn</code> function requires a <em>sweep dyn master file</em>.</p>
<p>The <em>sweep dyn master file</em> is the (xlsx) document containing all commands allowing <code>sweep_dyn</code> function to compose a scenario of 2 runs.</p>
<p>The two parameters to be sweeped over run #1 and #2 are defined by user directly in the function input, in the R console.</p>
<p>The format of the <em>sweep dyn master file</em> is the same as the <em>compose master file</em> and the <em>sweep steady master file</em>.</p>
<p>It is where the user sets the design of their 2 runs scenario to be sweeped:</p>
<ul>
<li>necessary: define the list of 2 runs composing the scenario (run durations, run resolutions, lists of fluxes, lists of coefficients).<br>
</li>
<li>optional: define the forcings over one or both runs composing the scenario (FORCING_RAYLEIGH, FORCING_ALPHA, FORCING_DELTA, FORCING_SIZE).</li>
</ul>
<p>The format of the <em>sweep dyn master file</em> is standardized. The user is encouraged to comply with these standards, as described thereafter, otherwise there is a high probability for these functions to crash.</p>
<div id="sweep-dyn-master-file-name-and-location" class="section level4">
<h4 class="hasAnchor">
<a href="#sweep-dyn-master-file-name-and-location" class="anchor"></a><strong>sweep dyn master file</strong> name and location</h4>
<ul>
<li>The <em>sweep dyn master file</em> is an xlsx file.<br>
</li>
<li>The <em>sweep dyn master file</em> name is chosen by user and specified in the <code>sweep_dyn</code> function inputs: [<em>e.g.</em>, <strong>0_SWEEP_DYN_MASTER.xlsx</strong> ].<br>
</li>
<li>the <em>sweep dyn master file</em> should be stored in the directory in which <em>isobxr master file</em> is found, where all runs for this box model system will be performed and where all outputs will be stored in automatically created subdirectories. This directory corresponds to the working directory (<em>workdir</em>) used as parameter of the <code>sweep_dyn</code> function.</li>
</ul>
</div>
<div id="sweep-dyn-master-file-structure" class="section level4">
<h4 class="hasAnchor">
<a href="#sweep-dyn-master-file-structure" class="anchor"></a><strong>sweep dyn master file structure</strong>
</h4>
<p>The <em>sweep dyn master file</em> contains the 5 following sheet strictly named as follows:</p>
<ol style="list-style-type: decimal">
<li>
<strong>RUN_LIST</strong>: define the list of 2 runs composing the sweep dyn scenario (run durations, run resolutions, lists of fluxes, lists of coefficients).<br>
</li>
<li>
<strong>FORCING_RAYLEIGH</strong>: define Rayleigh forcings over one or several runs composing the sweep 2 steps scenario.<br>
</li>
<li>
<strong>FORCING_ALPHA</strong>: define Rayleigh forcings over one or several runs composing the sweep 2 steps scenario.<br>
</li>
<li>
<strong>FORCING_DELTA</strong>: define initial delta forcings over one or several runs composing the sweep 2 steps scenario.<br>
</li>
<li>
<strong>FORCING_SIZE</strong>: define initial box size forcings over one or several runs composing the sweep 2 steps scenario.</li>
</ol>
</div>
<div id="run_list-sheet-filling-required-2" class="section level4">
<h4 class="hasAnchor">
<a href="#run_list-sheet-filling-required-2" class="anchor"></a><strong>RUN_LIST</strong> sheet (<em>FILLING REQUIRED</em>)</h4>
<p><img src="37_SW_STD_RUN_LIST.png" width="75%"></p>
<p>The <code>sweep_dyn</code> function strictly requires a list of <em>2</em> successive runs.</p>
<p>Both of these runs should be succesively described one by one on two rows of this sheet, with notably:</p>
<ol style="list-style-type: decimal">
<li>the run number (COMPO_RUN_n column)<br>
</li>
<li>the run duration (t_lim_list column)<br>
</li>
<li>the run resolution (nb_steps_list)<br>
</li>
<li>the flux list name (flux_list) that will be read from <em>isobxr master file</em><br>
</li>
<li>the coefficients list name (coeff_list) that will be read from <em>isobxr master file</em>
</li>
</ol>
</div>
<div id="forcing_size-sheet-filling-optional-2" class="section level4">
<h4 class="hasAnchor">
<a href="#forcing_size-sheet-filling-optional-2" class="anchor"></a><strong>FORCING_SIZE</strong> sheet (<em>FILLING OPTIONAL</em>)</h4>
<p><img src="37_SW_STD_FORCING_SIZE.png" width="50%"></p>
<p>See <em>composite master file</em> format description for details.</p>
</div>
<div id="forcing_delta-sheet-filling-optional-2" class="section level4">
<h4 class="hasAnchor">
<a href="#forcing_delta-sheet-filling-optional-2" class="anchor"></a><strong>FORCING_DELTA</strong> sheet (<em>FILLING OPTIONAL</em>)</h4>
<p><img src="37_SW_STD_FORCING_DELTA.png" width="50%"></p>
<p>See <em>composite master file</em> format description for details.</p>
</div>
<div id="forcing_alpha-sheet-filling-optional-2" class="section level4">
<h4 class="hasAnchor">
<a href="#forcing_alpha-sheet-filling-optional-2" class="anchor"></a><strong>FORCING_ALPHA</strong> sheet (<em>FILLING OPTIONAL</em>)</h4>
<p><img src="37_SW_STD_ALPHA.png" width="50%"></p>
<p>See <em>composite master file</em> format description for details.</p>
</div>
<div id="forcing_rayleigh-sheet-filling-optional-2" class="section level4">
<h4 class="hasAnchor">
<a href="#forcing_rayleigh-sheet-filling-optional-2" class="anchor"></a><strong>FORCING_RAYLEIGH</strong> sheet (<em>FILLING OPTIONAL</em>)</h4>
<p><img src="37_SW_STD_FORCING_RAYLEIGH.png" width="75%"></p>
<p>See <em>composite master file</em> format description for details.</p>
</div>
</div>
<div id="using-sweep_dyn" class="section level2">
<h2 class="hasAnchor">
<a href="#using-sweep_dyn" class="anchor"></a>Using <code>sweep_dyn</code>
</h2>
<div id="preparing-the-sweep-dyn-master-file" class="section level3">
<h3 class="hasAnchor">
<a href="#preparing-the-sweep-dyn-master-file" class="anchor"></a>Preparing the <em>sweep dyn master</em> file</h3>
<p>The user needs to define the two runs composing the 2 steps scenario.</p>
<ol style="list-style-type: decimal">
<li>The first run is typically used to let the system relax to its steady state used as an initial state in run #2.
<ol style="list-style-type: lower-roman">
<li>The user should consider here a balanced system. The <strong>isobxr</strong> functions will thus use the analytical solver (<code>ana_slvr</code>).</li>
<li>We thus recommand the user to set the number of steps for run #1 (nb_steps) to 1 (its' minimum value).<br>
This allows to only calculate the final state of the system, at the end of run #1.<br>
This reduces the calculation time and data produced without affecting the accuracy of the calculation.</li>
</ol>
</li>
<li>The second run is used to explore the dynamic response of the system in the face of a given <strong>perturbation</strong>, as a function of all combinations of parameters #1 and #2 values.
<ol style="list-style-type: lower-roman">
<li>The main purpose of this function is to explore the influence of the 2 combined parameters over the time dependent response of a system that previously relaxed to it's steady state.</li>
<li>The user has the choice to define a balanced or an unbalanced system in the run #2. A. The latter case (unbalanced system) could here constitute the perturbation of the system. The <code>sweep_dyn</code> function will here numerically solve the run #2 (<code>num_slvr</code>). A. In the case of a balanced system for run #2, the <code>sweep_dyn</code> function will analytically solve the run #2 (<code>ana_slvr</code>). A. The user should here be aware that the sweeping of the space of parameters using either the <code>num_slvr</code> or <code>ana_slvr</code> can be time consuming and require a fair bit of calculating power.<br>
The user is advised to wisely define the space of parameters (which will define the number of <span class="math inline">\(n \times m\)</span> iterations) as well as the run resoluion of run #2 (nb_steps).</li>
</ol>
</li>
</ol>
<dl>
<dt><strong>remark</strong></dt>
<dd>The reason why the <code>sweep_dyn</code> function sweeps both initial run #1 and run #2 is that the user might want to sweep parameters that are actually affecting the steady state of the system (e.g., sweep a series of lists of fluxes or coefficients).
</dd>
<dt><strong>Forcings</strong></dt>
<dd>The user can define some forcings over the system (will affect both run #1 and run #2).<br>
These forcings will overwrite the conditions set by the reading of the <em>isobxr master file</em>.<br>
These forcings will be overwritten by the sweeped parameters that affect run #1 and #2.
</dd>
</dl>
</div>
<div id="sweep_dyn-console-defined-sweep-parameters" class="section level3">
<h3 class="hasAnchor">
<a href="#sweep_dyn-console-defined-sweep-parameters" class="anchor"></a><code>sweep_dyn</code> console defined sweep parameters</h3>
<p>In addition to all the usual input parameters required for the <code>sweep_dyn</code> function, the user has to define the two parameters to be sweeped.</p>
<p>There are 6 types of sweepable parameters (or that can be explored), which names are strictly defined as follows:</p>
<pre><code>#&gt; [1] "EXPLO_n_FLUX_MATRICES"
#&gt; [1] "EXPLO_n_ALPHA_MATRICES"
#&gt; [1] "EXPLO_1_SIZE"
#&gt; [1] "EXPLO_1_DELTA"
#&gt; [1] "EXPLO_1_ALPHA"
#&gt; [1] "EXPLO_1_RAYLEIGH_ALPHA"</code></pre>
<div id="explo_n_flux_matrices-1" class="section level4">
<h4 class="hasAnchor">
<a href="#explo_n_flux_matrices-1" class="anchor"></a><strong>EXPLO_n_FLUX_MATRICES</strong>:</h4>
<p>This type of parameter allows to explore two series of flux lists as defined in <em>isobxr master file</em>, one for run #1 and one for run #2.</p>
<div class="sourceCode"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>VALUES_1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"flux_list_1"</span>,  <span class="co"># RUN #1 vector of n strings of chars.</span>
                        <span class="st">"..."</span>, 
                        <span class="st">"flux_list_i"</span>, 
                        <span class="st">"..."</span>, 
                        <span class="st">"flux_list_n"</span><span class="op">)</span>,  
           VALUES_2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"flux_list_1"</span>,  <span class="co"># RUN #2 vector of n strings of chars.</span>
                        <span class="st">"..."</span>, 
                        <span class="st">"flux_list_i"</span>, 
                        <span class="st">"..."</span>, 
                        <span class="st">"flux_list_n"</span><span class="op">)</span>,  
           EXPLO_TYPES <span class="op">=</span> <span class="st">"EXPLO_n_FLUX_MATRICES"</span><span class="op">)</span> <span class="co"># stricly leave as such</span></pre></div>
<p>The <strong>EXPLO_n_FLUX_MATRICES</strong> parameter will allow the <code>sweep_dyn</code> function to sweep the effect of two series of flux lists (defining flux matrices and initial box sizes) on run #1 and run #2 evolutions.</p>
<p>The format of this data frame should be exactly as shown above.</p>
<p>The values are two vectors of strings of characters containing the list of flux list names, that will be called from the <em>isobxr master file</em>.</p>
</div>
<div id="explo_n_alpha_matrices-1" class="section level4">
<h4 class="hasAnchor">
<a href="#explo_n_alpha_matrices-1" class="anchor"></a><strong>EXPLO_n_ALPHA_MATRICES</strong>:</h4>
<p>This type of parameter allows to explore two series of lists of coefficients as defined in <em>isobxr master file</em>, one for run #1 and one for run #2.</p>
<div class="sourceCode"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>VALUES_1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"coeff_list_1"</span>, <span class="co"># RUN #1 vector of n strings of chars.</span>
                        <span class="st">"..."</span>, 
                        <span class="st">"coeff_list_i"</span>, 
                        <span class="st">"..."</span>, 
                        <span class="st">"coeff_list_n"</span><span class="op">)</span>, 
           VALUES_2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"coeff_list_1"</span>, <span class="co"># RUN #2 vector of n strings of chars.</span>
                        <span class="st">"..."</span>, 
                        <span class="st">"coeff_list_i"</span>, 
                        <span class="st">"..."</span>, 
                        <span class="st">"coeff_list_n"</span><span class="op">)</span>, 
           EXPLO_TYPES <span class="op">=</span> <span class="st">"EXPLO_n_ALPHA_MATRICES"</span><span class="op">)</span> <span class="co"># stricly leave as such</span></pre></div>
<p>The <strong>EXPLO_n_ALPHA_MATRICES</strong> parameter will allow the <code>sweep_dyn</code> function to sweep the effect of two series of isotope fractionation coefficient lists (defining coefficient matrices) on run #1 and run #2 evolutions.</p>
<p>The format of this data frame should be exactly as shown above.</p>
<p>The values are two vectors of strings of characters containing the list of coefficients list names, that will be called from the <em>isobxr master file</em>.</p>
</div>
<div id="explo_1_size-1" class="section level4">
<h4 class="hasAnchor">
<a href="#explo_1_size-1" class="anchor"></a><strong>EXPLO_1_SIZE</strong>:</h4>
<p>This type of parameter allows to explore a range of sizes for a given box over both run #1 and run #2.</p>
<p>This parameter should be used only in the case where RUN #1 is balanced since it sets the initial box size for each run initial condition.</p>
<div class="sourceCode"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>BOXES_ID <span class="op">=</span> <span class="st">"BOX_i"</span>, <span class="co"># 1 string of char</span>
           SIZE_MIN <span class="op">=</span> <span class="st">"min_sweep_value"</span>, <span class="co"># 1 numerical value</span>
           SIZE_MAX <span class="op">=</span> <span class="st">"max_sweep_value"</span>, <span class="co"># 1 numerical value</span>
           SIZE_STEPS <span class="op">=</span> <span class="st">"sweep_steps"</span>, <span class="co"># 1 numerical value</span>
           EXPLO_TYPES <span class="op">=</span> <span class="st">"EXPLO_1_SIZE"</span><span class="op">)</span> <span class="co"># stricly leave as such</span></pre></div>
<p>The <strong>EXPLO_1_SIZE</strong> parameter will allow the <code>sweep_dyn</code> function to sweep the effect of a range of box sizes for a given box on run #1 and #2 evolution.</p>
<p>The format of this data frame should be exactly as shown above.</p>
</div>
<div id="explo_1_delta-1" class="section level4">
<h4 class="hasAnchor">
<a href="#explo_1_delta-1" class="anchor"></a><strong>EXPLO_1_DELTA</strong>:</h4>
<p>This type of parameter allows to explore a range of delta values for a given box over both run #1 and run #2.</p>
<p>This parameter should be used only for source boxes, since it will force the initial isotope composition of this box for both run #1 and run #2.</p>
<div class="sourceCode"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>BOXES_ID <span class="op">=</span> <span class="st">"BOX_i"</span>, <span class="co"># 1 string of char</span>
           DELTA_MIN <span class="op">=</span> <span class="st">"min_sweep_value"</span>, <span class="co"># 1 numerical value</span>
           DELTA_MAX <span class="op">=</span> <span class="st">"max_sweep_value"</span>, <span class="co"># 1 numerical value</span>
           DELTA_STEPS <span class="op">=</span> <span class="st">"sweep_steps"</span>, <span class="co"># 1 numerical value</span>
           EXPLO_TYPES <span class="op">=</span> <span class="st">"EXPLO_1_DELTA"</span><span class="op">)</span> <span class="co"># stricly leave as such</span></pre></div>
</div>
<div id="explo_1_alpha-1" class="section level4">
<h4 class="hasAnchor">
<a href="#explo_1_alpha-1" class="anchor"></a><strong>EXPLO_1_ALPHA</strong>:</h4>
<p>This type of parameter allows to explore a range of alpha (coeff) values for a given flux over both run #1 and run #2.</p>
<div class="sourceCode"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>FROM <span class="op">=</span> <span class="st">"BOX_i"</span>, <span class="co"># 1 string of char</span>
           TO <span class="op">=</span> <span class="st">"BOX_j"</span>, <span class="co"># 1 string of char</span>
           ALPHA_MIN <span class="op">=</span> <span class="st">"min_sweep_value"</span>, <span class="co"># 1 numerical value</span>
           ALPHA_MAX <span class="op">=</span> <span class="st">"max_sweep_value"</span>, <span class="co"># 1 numerical value</span>
           ALPHA_STEPS <span class="op">=</span> <span class="st">"sweep_steps"</span>, <span class="co"># 1 numerical value</span>
           EXPLO_TYPES <span class="op">=</span> <span class="st">"EXPLO_1_ALPHA"</span><span class="op">)</span> <span class="co"># stricly leave as such</span></pre></div>
</div>
<div id="explo_1_rayleigh_alpha-1" class="section level4">
<h4 class="hasAnchor">
<a href="#explo_1_rayleigh_alpha-1" class="anchor"></a><strong>EXPLO_1_RAYLEIGH_ALPHA</strong>:</h4>
<p>This type of parameter allows to explore a range of incremental alpha values for a Rayleigh distillation model for both run #1 and run #2. It is calculated for each run using the run's local flux configuration.</p>
<div class="sourceCode"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>XFROM <span class="op">=</span> <span class="st">"Box_B"</span>, <span class="co"># B&gt;C flux at numerator (strings of char)</span>
           XTO <span class="op">=</span> <span class="st">"Box_C"</span>,
           YFROM <span class="op">=</span> <span class="st">"Box_A"</span>, <span class="co"># A&gt;B flux at denominator (strings of char)</span>
           YTO <span class="op">=</span> <span class="st">"Box_B"</span>,
           AFROM <span class="op">=</span> <span class="st">"Box_B"</span>, <span class="co"># resulting fract. coefficient (strings of char)</span>
           ATO <span class="op">=</span> <span class="st">"Box_C"</span>,
           ALPHA_0_MIN <span class="op">=</span> <span class="st">"min_sweep_value"</span>, <span class="co"># value of incremental B&gt;A coeff. (num.)</span>
           ALPHA_0_MAX <span class="op">=</span> <span class="st">"max_sweep_value"</span>, 
           ALPHA_0_STEPS <span class="op">=</span> <span class="st">"sweep_steps"</span>,
           EXPLO_TYPES <span class="op">=</span> <span class="st">"EXPLO_1_RAYLEIGH_ALPHA"</span><span class="op">)</span> <span class="co"># stricly leave as such</span></pre></div>
<hr>
</div>
</div>
<div id="example-dynamic-sweeping-of-the-size-of-box-b-and-one-fractionation-coefficient-in-a-3-boxes-balanced-open-system-after-a-change-in-the-source-isotope-composition" class="section level3">
<h3 class="hasAnchor">
<a href="#example-dynamic-sweeping-of-the-size-of-box-b-and-one-fractionation-coefficient-in-a-3-boxes-balanced-open-system-after-a-change-in-the-source-isotope-composition" class="anchor"></a>Example: dynamic sweeping of the size of box B and one fractionation coefficient in a 3-boxes balanced open system after a change in the source isotope composition</h3>
<p>Both run #1 and run #2 are performed with the <em>a1</em> coefficients list, the <em>Fx6_ABC_open_bal</em> flux list and the sweeping paramaters.</p>
<p>The system faces a perturbation: the source isotope composition is shifted from 0 to -1 ‰ using the FORCING_DELTA sheet of the <em>sweeping dynamic master file</em>.</p>
<p>Here:</p>
<ul>
<li>using the <em>sweep dynamic master file</em> provided for demonstration (0_EXPLO_DYN_MASTER_demo1.xlsx)<br>
</li>
<li>we perform a sweep of the box B size values and <span class="math inline">\(\alpha _{A \to C}\)</span> values<br>
</li>
<li>during the first 1000 days of run #2<br>
</li>
<li>starting from a run #1 at steady state obtained by the relaxation of the system</li>
</ul>
<p>No forcings other than the FORCING_DELTA on the SOURCE box are applied.</p>
<p>To do so, the <code>sweep_steady</code> function can be used as follows:</p>
<div class="sourceCode"><pre class="downlit">
<span class="va">workdir</span> <span class="op">&lt;-</span> <span class="st">"~/DEMO_ABCD"</span> <span class="co"># isobxr and compo master file work. dir.</span>
<span class="va">SERIES_ID</span> <span class="op">&lt;-</span> <span class="st">"ABC_change_source_sweep_dyn_demo1"</span> <span class="co"># series ID of the set of compo runs</span>
<span class="va">time_units</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"days"</span>, <span class="st">"days"</span><span class="op">)</span> <span class="co"># time units for run (days) and for plots (years)</span>
<span class="va">EXPLO_MASTER</span> <span class="op">&lt;-</span> <span class="st">"0_EXPLO_DYN_MASTER_demo1.xlsx"</span> <span class="co"># compo master file name</span>

<span class="va">EXPLO_AXIS_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>BOXES_ID <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"B"</span><span class="op">)</span>, 
                           SIZE_MIN <span class="op">=</span> <span class="fl">1500</span>, 
                           SIZE_MAX <span class="op">=</span> <span class="fl">2500</span>, 
                           SIZE_STEPS <span class="op">=</span> <span class="fl">250</span>, 
                           EXPLO_TYPES <span class="op">=</span> <span class="st">"EXPLO_1_SIZE"</span><span class="op">)</span>

<span class="va">EXPLO_AXIS_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>FROM <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"A"</span><span class="op">)</span>, 
                           TO <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"C"</span><span class="op">)</span>, 
                           ALPHA_MIN <span class="op">=</span> <span class="fl">0.9988</span>, 
                           ALPHA_MAX <span class="op">=</span> <span class="fl">1</span>, 
                           ALPHA_STEPS <span class="op">=</span> <span class="fl">0.0004</span>, 
                           EXPLO_TYPES <span class="op">=</span> <span class="st">"EXPLO_1_ALPHA"</span><span class="op">)</span>

<span class="fu"><a href="../reference/sweep_dyn.html">sweep_dyn</a></span><span class="op">(</span><span class="va">workdir</span>,
          <span class="va">SERIES_ID</span>,
          <span class="va">time_units</span>,
          <span class="va">EXPLO_MASTER</span>,
          <span class="va">EXPLO_AXIS_1</span>, 
          <span class="va">EXPLO_AXIS_2</span><span class="op">)</span></pre></div>
<hr>
</div>
</div>
</div>
<div id="plotting-with-the-isobxr-plot-editor-app" class="section level1">
<h1 class="hasAnchor">
<a href="#plotting-with-the-isobxr-plot-editor-app" class="anchor"></a>Plotting with the isobxr plot editor app</h1>
<div id="calling-the-shiny-app" class="section level2">
<h2 class="hasAnchor">
<a href="#calling-the-shiny-app" class="anchor"></a>Calling the Shiny app</h2>
<p>The <code>runShinyPlots</code> function calls an <strong>isobxr Shiny app</strong> plotting interface (html interface accessible with any type of internet browser).</p>
<p>This app is still in its' <span class="math inline">\(\beta\)</span> version but already allows to create many plots with a series of options for all outputs given by <code>compose_isobxr</code>, <code>sweep_steady</code> &amp; <code>sweep_dyn</code> functions.</p>
<p>This is notably very useful for the complex outputs of <code>sweep_steady</code> &amp; <code>sweep_dyn</code> functions.</p>
<p>This app also allows to export a pdf version of the plot.</p>
<div class="sourceCode"><pre class="downlit">
<span class="co"># define workdir in which the SERIES directories are found </span>
<span class="co"># (SERIES directories start with 3_CPS, 4_STD or 4_DYN) </span>
<span class="co"># for instance:</span>
<span class="va">workdir</span> <span class="op">&lt;-</span> <span class="st">"~/DEMO_ABCD"</span>

<span class="co"># Launch the shiny app</span>
<span class="fu"><a href="../reference/runShinyPlots.html">runShinyPlots</a></span><span class="op">(</span><span class="op">)</span></pre></div>
</div>
<div id="short-introduction-to-the-graphic-interface" class="section level2">
<h2 class="hasAnchor">
<a href="#short-introduction-to-the-graphic-interface" class="anchor"></a>Short introduction to the graphic interface</h2>
<div id="welcome-page" class="section level3">
<h3 class="hasAnchor">
<a href="#welcome-page" class="anchor"></a>Welcome page</h3>
<p><img src="39_shiny_1.png" width="100%"></p>
</div>
<div id="selecting-a-series-directory" class="section level3">
<h3 class="hasAnchor">
<a href="#selecting-a-series-directory" class="anchor"></a>Selecting a series directory</h3>
<p><img src="39_shiny_2.png" width="100%"></p>
</div>
<div id="plotting-compose_isobxr-outputs" class="section level3">
<h3 class="hasAnchor">
<a href="#plotting-compose_isobxr-outputs" class="anchor"></a>Plotting <code>compose_isobxr</code> outputs</h3>
<p><img src="39_shiny_3.png" width="100%"></p>
</div>
<div id="plotting-sweep_steady-outputs-at-final-state" class="section level3">
<h3 class="hasAnchor">
<a href="#plotting-sweep_steady-outputs-at-final-state" class="anchor"></a>Plotting <code>sweep_steady</code> outputs at final state</h3>
<p><img src="39_shiny_5.png" width="100%"></p>
</div>
<div id="plotting-sweep_dyn-outputs" class="section level3">
<h3 class="hasAnchor">
<a href="#plotting-sweep_dyn-outputs" class="anchor"></a>Plotting <code>sweep_dyn</code> outputs</h3>
<p><img src="39_shiny_4.png" width="100%"></p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Theo Tacail.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
