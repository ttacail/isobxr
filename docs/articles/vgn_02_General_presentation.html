<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>2 - General presentation • isobxr</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="2 - General presentation">
<meta property="og:description" content="isobxr">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">isobxr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/vgn_01_Installation.html">1 - Install isobxr</a>
    </li>
    <li>
      <a href="../articles/vgn_02_General_presentation.html">2 - General presentation</a>
    </li>
    <li>
      <a href="../articles/vgn_03_Run_isobxr_presentation.html">3 - run_isobxr()</a>
    </li>
    <li>
      <a href="../articles/vgn_05_compose_isobxr.html">4 - compose_isobxr()</a>
    </li>
    <li>
      <a href="../articles/vgn_07_sweep_steady.html">5 - sweep_steady()</a>
    </li>
    <li>
      <a href="../articles/vgn_08_sweep_dyn.html">6 - sweep_dyn()</a>
    </li>
    <li>
      <a href="../articles/vgn_09_runShinyPlots.html">7 - shinobxr_app()</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/ttacail/isobxr/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>2 - General presentation</h1>
                        <h4 class="author">Théo Tacail</h4>
            
            <h4 class="date">2021-08-26</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/ttacail/isobxr/blob/master/vignettes/vgn_02_General_presentation.Rmd"><code>vignettes/vgn_02_General_presentation.Rmd</code></a></small>
      <div class="hidden name"><code>vgn_02_General_presentation.Rmd</code></div>

    </div>

    
    
<hr>
<p><a href="https://ttacail.github.io/isobxr_web/">Full documentation and tutorials can be found on the isobxr website.</a></p>
<hr>
<p>The <a href="https://ttacail.github.io/isobxr/">isobxr</a> package is a set of R tools designed to perform and explore stable isotope box modelling of open or closed systems. It provides a ready-to-use tool allowing users to develop and test isotopic box models of their system of interest. It allows the user to explore the behavior of these systems in both static (<em>e.g.</em>, at steady state) or dynamic modes (<em>e.g.</em>, in reaction to a perturbation), build complex scenarios, and sweep the space of parameters in both static and dynamic modes.</p>
<hr>
<div id="introduction-to-isobxr-approach" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction-to-isobxr-approach" class="anchor"></a>Introduction to isobxr approach</h1>
<div id="systems-and-modelling-approach" class="section level2">
<h2 class="hasAnchor">
<a href="#systems-and-modelling-approach" class="anchor"></a>Systems and modelling approach</h2>
<p>The global definition of the systems considered for the stable isotope box modelling by <a href="https://ttacail.github.io/isobxr/">isobxr</a> is presented in the cheatsheet below.</p>
<p><img src="02_basics_01_sysdef.png" width="100%"></p>
</div>
<div id="fundamental-workflow" class="section level2">
<h2 class="hasAnchor">
<a href="#fundamental-workflow" class="anchor"></a>Fundamental workflow</h2>
<ul>
<li><p><code>run_isobxr</code> is the main function of the <a href="https://ttacail.github.io/isobxr/">isobxr</a> package.</p></li>
<li><p><code>run_isobxr</code> is used to perform single runs of stable isotope box models of all types of systems.</p></li>
<li><p>The general workflow of the <code>run_isobxr</code> function is summarized in the cheatsheet below.</p></li>
</ul>
<p><img src="02_basics_02_runisobxr_wflow.png" width="100%"></p>
<hr>
</div>
</div>
<div id="box-modelling-equations" class="section level1">
<h1 class="hasAnchor">
<a href="#box-modelling-equations" class="anchor"></a>Box modelling equations</h1>
<p>In this section we present the mathematical formalism used in isobxr stable isotope box modelling.</p>
<p>The theory and formalism shown in this section is derived from the chapter 7 (<em>Dynamic systems</em>) of</p>
<p>: Albarède, F., 1995. Introduction to Geochemical Modelling. Cambridge University Press, Cambridge.<br><a href="https://doi.org/10.1017/CBO9780511622960" class="uri">https://doi.org/10.1017/CBO9780511622960</a></p>
<div id="definitions" class="section level2">
<h2 class="hasAnchor">
<a href="#definitions" class="anchor"></a>Definitions</h2>
<p>We consider a system consisting of <span class="math inline">\(n\)</span> boxes <span class="math inline">\(j\)</span>, exchanging an element <strong>X</strong> that has at least two stable isotopes <span class="math inline">\(M\)</span> and <span class="math inline">\(N\)</span>. Any box <span class="math inline">\(i\)</span> is defined by:</p>
<ul>
<li>
<span class="math inline">\(m^X_i\)</span> the mass of element <strong>X</strong> in box <span class="math inline">\(i\)</span> - also referred to as <strong>box size</strong> thereafter</li>
<li>
<span class="math inline">\(m^M_i\)</span> and <span class="math inline">\(m^N_i\)</span> the masses of isotopes <span class="math inline">\(M\)</span> and <span class="math inline">\(N\)</span> in box <span class="math inline">\(i\)</span>, respectively</li>
<li>
<span class="math inline">\(J_{i \mapsto j}^X\)</span> is the mass flux of <strong>X</strong> from <span class="math inline">\(i\)</span> to <span class="math inline">\(j\)</span> (homogeneous to a mass per time unit)</li>
</ul>
<p><img src="02_basics_03_Box_model_principle.png" width="100%"></p>
<p>We call <span class="math inline">\(R_i\)</span> the <span class="math inline">\(M/N\)</span> isotope abundance ratio: <span class="math display">\[R_i = \left(\dfrac{n^M}{n^N}\right)_i = \left(\dfrac{m^M}{m^N}\right)_i \times \left(\dfrac{M^N}{M^M}\right) =   \left(\dfrac{m^M}{m^N}\right)_i A \]</span> where</p>
<ul>
<li>
<span class="math inline">\(n^M_i\)</span> and <span class="math inline">\(n^N_i\)</span> are the molar quantities of isotopes <span class="math inline">\(M\)</span> and <span class="math inline">\(N\)</span> in box <span class="math inline">\(i\)</span>
</li>
<li>
<span class="math inline">\(M^M\)</span> and <span class="math inline">\(M^N\)</span> are the molar masses of isotopes <span class="math inline">\(M\)</span> and <span class="math inline">\(N\)</span> in box <span class="math inline">\(i\)</span>
</li>
<li>
<span class="math inline">\(A = \left(\frac{M^N}{M^M}\right)\)</span> the ratio of the molar masses of <span class="math inline">\(N\)</span> and <span class="math inline">\(M\)</span>.</li>
</ul>
<p>Finally, we define <span class="math inline">\(D_{i \mapsto j}^{M/N}\)</span> the relative fractionation coefficient between M and N from <span class="math inline">\(i\)</span> to <span class="math inline">\(j\)</span>:</p>
<p><span class="math display">\[D_{i \mapsto j}^{M/N} = \dfrac{{J_{i \mapsto j}^M}/{J_{i \mapsto j}^N}}{m^M_i/m^N_i}\]</span></p>
<p>The principle of modelling the system consists now in predicting the evolution of <strong>box sizes</strong> (<span class="math inline">\(m^X_i\)</span>) during time and the evolution of the <strong>isotope ratios</strong> (<span class="math inline">\(R_i\)</span>), knowing the fluxes, initial box sizes and fractionation coefficients.</p>
</div>
<div id="mass-conservation-of-element-x" class="section level2">
<h2 class="hasAnchor">
<a href="#mass-conservation-of-element-x" class="anchor"></a>Mass conservation of element X</h2>
<p>Considering <strong>X</strong> has <strong>no radioactive nor radiogenic component</strong>, mass conservation for element <strong>X</strong> reads :</p>
<p><span class="math display">\[\dfrac{dm^X_i}{dt} = - \sum \limits_{j\neq i} J_{i \mapsto j}^X + \sum \limits_{j\neq i} J_{j \mapsto i}^X\]</span></p>
<p>When considering constant fluxes, this equation can be integrated in its linear form as follows:</p>
<p><span class="math display">\[m^X_i = \left(- \sum \limits_{j\neq i} J_{i \mapsto j}^X + \sum \limits_{j\neq i} J_{j \mapsto i}^X\right) \times t + m^X_{i, t_0}\]</span></p>
<p>where <span class="math inline">\(m^X_{i, t_0}\)</span> is the mass of element <strong>X</strong> in box <span class="math inline">\(i\)</span> at t = 0.</p>
</div>
<div id="differential-equations" class="section level2">
<h2 class="hasAnchor">
<a href="#differential-equations" class="anchor"></a>Differential equations</h2>
<p>Considering <span class="math inline">\(N\)</span> and <span class="math inline">\(M\)</span> are stable and non radiogenic, mass conservation reads :</p>
<p><span class="math display">\[\dfrac{dm^N_i}{dt} = - \sum \limits_{j\neq i} J_{i \mapsto j}^N + \sum \limits_{j\neq i} J_{j \mapsto i}^N = - \sum \limits_{j\neq i} \dfrac{J_{i \mapsto j}^N}{m^N_i} m^N_i + \sum \limits_{j\neq i} \dfrac{J_{j \mapsto i}^N}{m^N_j} m^N_j\]</span></p>
<p>Likewise,</p>
<p><span class="math display">\[\dfrac{dm^M_i}{dt} = - \sum \limits_{j\neq i} \dfrac{J_{i \mapsto j}^M}{m^M_i} m^M_i + \sum \limits_{j\neq i} \dfrac{J_{j \mapsto i}^M}{m^M_j} m^M_j\]</span></p>
<p>We can meanwhile derive the ratio <span class="math inline">\(R_i\)</span> as :</p>
<p><span class="math display">\[\dfrac{dR_i}{dt} = \dfrac{d}{dt}\left(\dfrac{m^M}{m^N}\right)_i A  = \dfrac{A}{{m^N_i}^2} \left(m^N_i\dfrac{dm^M_i}{dt} - m^M_i \dfrac{dm^N_i}{dt}\right) = \dfrac{A}{m^N_i} \left(\dfrac{dm^M_i}{dt} - \dfrac{R_i}{A} \dfrac{dm^N_i}{dt}\right)\]</span></p>
<p>We can insert mass conservation derivative into previous relationship:</p>
<p><span class="math display">\[\dfrac{dR_i}{dt} = \dfrac{A}{m^N_i} \left(- \sum \limits_{j\neq i} \dfrac{J_{i \mapsto j}^M}{m^M_i} m^M_i + \sum \limits_{j\neq i} \dfrac{J_{j \mapsto i}^M}{m^M_j} m^M_j + \dfrac{R_i}{A}  \sum \limits_{j\neq i} \dfrac{J_{i \mapsto j}^N}{m^N_i} m^N_i - \dfrac{R_i}{A}  \sum \limits_{j\neq i} \dfrac{J_{j \mapsto i}^N}{m^N_j} m^N_j   \right)\]</span></p>
<p>Modified as such :</p>
<p><span class="math display">\[\dfrac{dR_i}{dt} = A \left(- \sum \limits_{j\neq i} \dfrac{J_{i \mapsto j}^M}{m^M_i} \dfrac{m^M_i}{m^N_i} + \sum \limits_{j\neq i} \dfrac{J_{j \mapsto i}^M}{m^M_j} \dfrac{m^M_j}{m^N_j} \dfrac{m^N_j}{m^N_i} + \dfrac{R_i}{A} \sum \limits_{j\neq i} \dfrac{J_{i \mapsto j}^N}{m^N_i} - \dfrac{R_i}{A} \sum \limits_{j\neq i} \dfrac{J_{j \mapsto i}^N}{m^N_j} \dfrac{m^N_j}{m^N_i}   \right)\]</span></p>
<p><span class="math display">\[\dfrac{dR_i}{dt} = A \left(- \sum \limits_{j\neq i} \dfrac{J_{i \mapsto j}^M}{m^M_i} \dfrac{R_i}{A} + \sum \limits_{j\neq i} \dfrac{J_{j \mapsto i}^M}{m^M_j} \dfrac{R_j}{A} \dfrac{m^N_j}{m^N_i} + \dfrac{R_i}{A} \sum \limits_{j\neq i} \dfrac{J_{i \mapsto j}^N}{m^N_i} - \dfrac{R_i}{A} \sum \limits_{j\neq i} \dfrac{J_{j \mapsto i}^N}{m^N_j} \dfrac{m^N_j}{m^N_i}   \right)\]</span></p>
<p><span class="math display">\[\dfrac{dR_i}{dt}  = R_i \sum \limits_{j \neq i} \left(\dfrac{J^N_{i \mapsto j}}{m^N_i} - \dfrac{J^M_{i \mapsto j}}{m^M_i} \right) +  \sum \limits_{j \neq i} \dfrac{J^M_{j \mapsto i}}{m^M_j} \dfrac{m^N_j}{m^N_i} R_j - \sum \limits_{j \neq i}  \dfrac{J^N_{j \mapsto i}}{m^N_j} \dfrac{m^N_j}{m^N_i} R_i\]</span></p>
<p><span class="math display">\[\dfrac{dR_i}{dt} = R_i \sum \limits_{j \neq i} \left(\dfrac{J^N_{i \mapsto j}}{m^N_i} - \dfrac{J^M_{i \mapsto j}}{m^M_i} \right) +  
\sum \limits_{j \neq i} \left( \dfrac{J^M_{j \mapsto i}}{m^M_j} R_j - \dfrac{J^N_{j \mapsto i}}{m^N_j} R_i \right) \dfrac{m^N_j}{m^N_i}\]</span></p>
<p><span class="math display">\[\dfrac{dR_i}{dt} = 
R_i \sum \limits_{j \neq i} \dfrac{J_{i \mapsto j}^N}{m^N_i} \left(1- \dfrac{{J_{i \mapsto j}^M}/{J_{i \mapsto j}^N}}{{m^M_i}/{m^N_i}}\right) + \sum \limits_{j \neq i} \dfrac{J_{j \mapsto i}^N}{m^N_j} \left(\dfrac{{J_{j \mapsto i}^M}/{J_{j \mapsto i}^N}}{m^M_j / m^N_j} R_j - R_i \right) \dfrac{m^N_j}{m^N_i}\]</span></p>
<p>Resulting in :</p>
<p><span class="math display">\[\dfrac{dR_i}{dt} = 
R_i \sum \limits_{j \neq i} \dfrac{J_{i \mapsto j}^N}{m^N_i} \left(1- D_{i \mapsto j}^{M/N} \right) + \sum \limits_{j \neq i} \dfrac{J_{j \mapsto i}^N}{m^N_j} \left(D_{j \mapsto i}^{M/N} R_j - R_i \right) \dfrac{m^N_j}{m^N_i}\]</span></p>
<p>In order to solve this equation, we assume that:</p>
<p><span class="math display">\[\begin{array}{ccccc}
\dfrac{J_{i \mapsto j}^N}{m^N_i} \simeq \dfrac{J_{i \mapsto j}^X}{m^X_i} &amp; , &amp;
\dfrac{J_{j \mapsto i}^N}{m^N_j} \simeq \dfrac{J_{j \mapsto i}^X}{m^X_j} &amp; , &amp;
\dfrac{m^N_j}{m^N_i} \simeq \dfrac{m^X_j}{m^X_i}
\end{array}\]</span></p>
<p>These assumptions are valid for amplitude of stable isotope fractionations of the order of tens of ‰.</p>
<p>These assumptions find their limitation in the case of ample stable isotope fractionations such as sometimes observed for isotopic systems of light elements (such as D/H). In these cases, the differences in reactivity can be too great and amplitudes of stable isotope fractionations too marked for the assumptions to be applicable.</p>
<p>We thus have the following <strong>system of first order differential equations</strong> used thereafter:</p>
<p><span class="math display">\[
\dfrac{dR_i}{dt} = 
R_i \sum \limits_{j \neq i} \dfrac{J_{i \mapsto j}^X}{m^X_i} \left(1- D_{i \mapsto j}^{M/N} \right) + \sum \limits_{j \neq i} \dfrac{J_{j \mapsto i}^X}{m^X_j} \left(D_{j \mapsto i}^{M/N} R_j - R_i \right) \dfrac{m^X_j}{m^X_i}
\]</span></p>
<p>This system can be solved in order to reconstruct the evolution of stable isotope ratios <span class="math inline">\(R_i(t)\)</span> in each box over time.</p>
<p>Two main situations can be distinguished here.</p>
<ol style="list-style-type: decimal">
<li>
<p><strong>The inward and outward fluxes of element X for any given box are balanced</strong></p>
<p>In this case, all box sizes (<span class="math inline">\(m^X_i\)</span>) are constant, which means that <span class="math inline">\({dm^X_i}/{dt} = 0\)</span> for all boxes.</p>
<p>The reconstruction of <span class="math inline">\(R_i(t)\)</span> only requires the solving of the system of ordinary first order differential equations.</p>
<p>This can be done analytically <em>via</em> the algebraic inversion of the equation system matrix. This is what the <code>ana_slvr</code> core functions does.</p>
</li>
<li>
<p><strong>The inward and outward fluxes of element X for at least one box is unbalanced</strong></p>
<p>In this case, at least one box displays a varying mass of element <strong>X</strong> with time (<span class="math inline">\(m^X_i(t)\)</span>) which means that <span class="math inline">\({dm^X_i}/{dt} \neq 0\)</span> for at least one box.</p>
<p>The reconstruction of <span class="math inline">\(R_i(t)\)</span> requires the simultaneous solving of the system of ordinary first order differential equations describing <span class="math inline">\(R_i(t)\)</span> and of the derivative of <span class="math inline">\(m^X_i(t)\)</span> (with a linear solution).</p>
<p>This is performed numerically <em>via</em> an incremental integration as done by the <code>num_slvr</code> core function.</p>
</li>
</ol>
<p>All <span class="math inline">\(R_i(t)\)</span> stable isotope ratios can be also expressed as <span class="math inline">\(\delta_i(t)\)</span> values expressed in the ‰ unit, defined as follows and where <span class="math inline">\(R_{std}\)</span> is the stable isotope ratio of the standard or reference material:</p>
<p><span class="math display">\[\delta^{M/N}X_i(t) = \left(\dfrac{R_i(t)}{R_{std}} - 1\right) \times 1000 \]</span></p>
</div>
</div>
<div id="isobxr-solvers" class="section level1">
<h1 class="hasAnchor">
<a href="#isobxr-solvers" class="anchor"></a>isobxr solvers</h1>
<p>The <a href="https://ttacail.github.io/isobxr/">isobxr</a> package uses two core solver functions to solve the system of differential equations: <code>num_slvr</code> and <code>ana_slvr</code>.</p>
<p>These functions are not intended to be directly called by users themselves, although this remains possible.</p>
<p>These functions are called within broader functions (e.g., <code>run_isobxr</code>).</p>
<p>Because these functions are the actual solvers of the stable isotope box model equation systems, you will find here a description of their functioning and applicability.</p>
<p>You can also refer to the documentation for these two functions by typing the following code into your R console:</p>
<div class="sourceCode"><pre class="downlit">
<span class="op">?</span><span class="va">ana_slvr</span>
<span class="op">?</span><span class="va">num_slvr</span></pre></div>
<div id="input-file" class="section level2">
<h2 class="hasAnchor">
<a href="#input-file" class="anchor"></a><strong>INPUT</strong> file</h2>
<p>The <strong>INPUT</strong> file contains the set of commands required to run either <code>ana_slvr</code> or <code>num_slvr</code>.</p>
<p>Its format and name are standardized and should not be altered.</p>
<p>Its direct modification by user is not required because <strong>INPUT</strong> files are edited by the broader and user-friendly <code>run_isobxr</code> function, described in another section of this vignette.</p>
<div id="file-name-and-format" class="section level3">
<h3 class="hasAnchor">
<a href="#file-name-and-format" class="anchor"></a>File name and format</h3>
<ul>
<li>The <strong>INPUT</strong> file is a <strong>Rda</strong> file (R data format allowing to store multiple R objects)</li>
<li>The <strong>INPUT</strong> file name has to end with the following: [ <strong>IN.Rda</strong> ].<br>
</li>
<li>The <strong>INPUT</strong> file name structure is [ <strong>RUN name + IN.Rda</strong> ].<br>
</li>
<li>
<em>Example</em>: [ <strong>this_is_a_run_name_IN.Rda</strong> ]</li>
</ul>
</div>
<div id="file-content" class="section level3">
<h3 class="hasAnchor">
<a href="#file-content" class="anchor"></a>File content</h3>
<p>The <strong>INPUT</strong> file contains at least the 4 following objects strictly named as follows:</p>
<ol style="list-style-type: decimal">
<li>
<strong>CONSTS_IN</strong>: Dataframe documenting the constants<br>
</li>
<li>
<strong>INITIAL_IN</strong>: Dataframe documenting the initial conditions of all box sizes (even empty ones) and all initial delta values.</li>
<li>
<strong>FLUXES_IN</strong>: Dataframe documenting the mass fluxes of element X between all boxes (structured as a square matrix)</li>
<li>
<strong>COEFFS_IN</strong>: Dataframe documenting the isotopic fractionation coefficients between all boxes (structured as a square matrix)</li>
</ol>
<p>The <strong>INPUT</strong> file is an output from the <code>run_isobxr</code> function and does not require the user intervention.</p>
</div>
</div>
<div id="numerical-solver-num_slvr" class="section level2">
<h2 class="hasAnchor">
<a href="#numerical-solver-num_slvr" class="anchor"></a>Numerical solver (<strong>num_slvr</strong>)</h2>
<p>The numerical solver <code>num_slvr</code> iteratively integrates the derivatives of the box sizes (<span class="math inline">\(\frac{dm^X_i}{dt}\)</span>) and isotope ratios (<span class="math inline">\(\frac{dR_i}{dt}\)</span>) over the whole run duration.</p>
<p>The <code>num_slvr</code> uses the <code>ode</code> ordinary differential equation integrating function from the <strong>deSolve</strong> package.</p>
<div id="applicability" class="section level3">
<h3 class="hasAnchor">
<a href="#applicability" class="anchor"></a>Applicability</h3>
<p>This function solves the evolution of both the isotope ratios and the sizes of each box defined by user.</p>
<p>The <code>num_slvr</code> function therefore can be used in <strong>two distinct cases</strong>:</p>
<ol style="list-style-type: decimal">
<li>
<p>In the case of <strong>balanced inward and outward fluxes</strong> of element <strong>X</strong> between all involved boxes.</p>
<p>The derivative of box sizes will be null (<span class="math inline">\(\frac{dm^X_i}{dt} = 0\)</span>), in other words all box sizes will be constant.</p>
</li>
<li>
<p>In the case of <strong>unbalanced inward and outward fluxes</strong> of element <strong>X</strong> for at least one box of the system.</p>
<p>The derivative of box sizes will be non null in at least one case (<span class="math inline">\(\frac{dm^X_i}{dt} \neq 0\)</span>), in other words at least on box loses and accumulates the element X.</p>
</li>
</ol>
<p>The drawbacks of this function is that</p>
<ul>
<li>Its accuracy depends on the time resolution of the run.</li>
<li>The calculation can be time consuming.<br>
</li>
<li>We miss information on the system dynamics, which an analytical solver could bring.</li>
</ul>
<p><strong>The use of this function is thus preferred in the case of unbalanced fluxes</strong>, where at least one box loses or accumulates the element <strong>X</strong> over time (case #2).</p>
<p>It then allows to study the dynamic responses of a system to a perturbation of the flux balance for at least one box.</p>
</div>
<div id="using-num_slvr" class="section level3">
<h3 class="hasAnchor">
<a href="#using-num_slvr" class="anchor"></a>Using <strong>num_slvr</strong>
</h3>
<p><em>Remark</em>: The direct use of <code>num_slvr</code> function by user is not intended because this function is integrated in the global <code>run_isobxr</code> function described thereafter.</p>
<p>The <code>num_slvr</code> function reads an <strong>INPUT</strong> file (file name structure: [ <strong>RUN name + INPUT.Rda</strong> ]) containing all commands for the required model run, namely:</p>
<ul>
<li>
<em>Constants</em> (CONSTS_IN) defining the system (Element symbol, isotopes considered, standard or reference material isotope ratio, run duration and number of time steps)<br>
</li>
<li>
<em>Initial conditions</em> (INITIAL_IN) where each box is associated to an initial size (mass of element X) and an initial isotope composition expressed in delta value (‰ unit)<br>
</li>
<li>A matrix <em>fluxes</em> (FLUXES_IN) of element <strong>X</strong> between all boxes of the system (in mass unit per time unit)<br>
</li>
<li>A matrix of <em>isotope fractionation coefficients</em> (COEFFS_IN) associated to all boxes of the system</li>
</ul>
<p>The <code>num_slvr</code> function returns the numerically determined evolution of the stable isotope ratios and masses of element <strong>X</strong> in all boxes over the run duration.</p>
<p>The <code>num_slvr</code> <strong>OUTPUT</strong> contains the following:</p>
<ul>
<li>OUT data file storing initial and final size and delta values in each box</li>
<li>evS data file storing the evolution of the sizes (masses of element X) of each box</li>
<li>evD data file storing the evolution of the delta values in each box</li>
</ul>
<p>By default (save_run_outputs = FALSE), all <strong>OUTPUT</strong> data is stored in a temporary directory. If save_run_outputs = TRUE, the outputs are saved in the same directory as the input file.</p>
<p>By default, all <strong>OUTPUT</strong> data is saved in a <strong>Rda</strong> output file (<strong>RUN name + OUT.Rda</strong>).</p>
<p>The <code>num_slvr</code> function optionally allows user to edit the <strong>OUTPUT</strong> data as <strong>csv</strong> files stored in a DIGEST folder ([ <strong>RUN name + DIGEST</strong> ]) with the following name structures:</p>
<ul>
<li>OUT data: [ <strong>out_1_N_OUT + RUN name + .csv</strong> ]</li>
<li>evS data: [ <strong>out_2_N_evS + RUN name + .csv</strong> ]</li>
<li>evD data: [ <strong>out_3_N_evD + RUN name + .csv</strong> ]</li>
</ul>
</div>
</div>
<div id="analytical-solver-ana_slvr" class="section level2">
<h2 class="hasAnchor">
<a href="#analytical-solver-ana_slvr" class="anchor"></a>Analytical solver (<strong>ana_slvr</strong>)</h2>
<p>The analytical solver <code>ana_slvr</code> calculates the analytical solutions of the system of ordinary differential equations (ODES) of stable isotope ratios for an element <strong>X</strong> in all boxes.</p>
<p>It determines the eigenvalues, eigenvectors and constants defined by initial conditions associated to the ODES, and allows to determine the functions that describe the evolution of stable isotope ratios as a function of time.</p>
<div id="applicability-1" class="section level3">
<h3 class="hasAnchor">
<a href="#applicability-1" class="anchor"></a>Applicability</h3>
<p>In this case, the box sizes are considered as constant because the solving of the system of differential equations only considers the isotope ratios as varying with time.</p>
<p>In other words, in the case of <strong>balanced inward and outward fluxes</strong> for all finite boxes (<span class="math inline">\(\frac{dm^X_i}{dt} = 0\)</span>), this function allows to accurately determine the expression of the stable isotope ratio in a given box as a function of time.</p>
<p>The function also edits a dataset of the evolution of isotope compositions in each box over the time range, with the time resolution determined by the user.</p>
<p>The use of this function is thus <strong>not applicable in the case of unbalanced fluxes</strong> for one finite box or more.</p>
<p>However, the <code>ana_slvr</code> function can be used in balanced open systems, with boxes defined as infinite and unbalanced sources or sinks, as described in the model design section thereafter.</p>
</div>
<div id="using-ana_slvr" class="section level3">
<h3 class="hasAnchor">
<a href="#using-ana_slvr" class="anchor"></a>Using <strong>ana_slvr</strong>
</h3>
<p><em>Remark</em>: The direct use of <code>ana_slvr</code> function by user is not intended because this function is integrated in the global <code>run_isobxr</code> function described thereafter.</p>
<p>The <code>ana_slvr</code> function reads an <strong>INPUT</strong> file (file name structure: [ <strong>RUN name + INPUT.Rda</strong> ]) containing all commands for the required model run, namely:</p>
<ul>
<li>
<em>Constants</em> (CONSTS_IN) defining the system (Element symbol, isotopes considered, standard or reference material isotope ratio, run duration and number of time steps)<br>
</li>
<li>
<em>Initial conditions</em> (INITIAL_IN) where each box is associated to an initial size (mass of element X) and an initial isotope composition expressed in delta value (‰ unit)<br>
</li>
<li>A matrix <em>fluxes</em> (FLUXES_IN) of element <strong>X</strong> between all boxes of the system (in mass unit per time unit)<br>
</li>
<li>A matrix of <em>isotope fractionation coefficients</em> (COEFFS_IN) associated to all boxes of the system</li>
</ul>
<p>The <code>ana_slvr</code> function returns the analytical solutions of the ODES which describes the stable isotope ratios in each box. The <code>ana_slvr</code> function also returns the evolution of the delta values in each box. (in ‰, relative to the reference material).</p>
<p>The <code>ana_slvr</code> <strong>OUTPUT</strong> contains the following:</p>
<ul>
<li>OUT data file storing initial and final size and delta values in each box</li>
<li>
<p>ODE_SOLNs data file summarizing outputs of the analytical solutions of the ODES</p>
<p>(eigenvalues, eigenvectors, relaxation times, constants according to initial conditions)</p>
</li>
<li><p>evD data file storing the evolution of the delta values in each box</p></li>
</ul>
<p>By default (save_run_outputs = FALSE), all <strong>OUTPUT</strong> data is stored in a temporary directory. If save_run_outputs = TRUE, the outputs are saved in the same directory as the input file.</p>
<p>By default, all <strong>OUTPUT</strong> data is saved in a <strong>Rda</strong> output file (<strong>RUN name + OUT.Rda</strong>).</p>
<p>The <code>ana_slvr</code> function optionally allows user to edit the <strong>OUTPUT</strong> data as <strong>csv</strong> files stored in a DIGEST folder ([ <strong>RUN name + DIGEST</strong> ]) with the following name structures:</p>
<ul>
<li>OUT data: [ <strong>out_1_A_OUT + RUN name + .csv</strong> ]</li>
<li>ODE_SOLNs data: [ <strong>out_2_A_ODE_SOLNs + RUN name + .csv</strong> ]</li>
<li>evD data: [ <strong>out_3_A_evD + RUN name + .csv</strong> ]</li>
</ul>
<hr>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Theo Tacail.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
